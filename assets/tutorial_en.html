<!DOCTYPE html>
<html>
<head>
<style>
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.catala-code .hll { background-color: #ffffcc }
.catala-code { background: #f8f8f8; }
.catala-code .c { color: #3D7B7B; font-style: italic } /* Comment */
.catala-code .err { border: 1px solid #FF0000 } /* Error */
.catala-code .k { color: #008000; font-weight: bold } /* Keyword */
.catala-code .o { color: #666666 } /* Operator */
.catala-code .ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
.catala-code .cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
.catala-code .cp { color: #9C6500 } /* Comment.Preproc */
.catala-code .cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
.catala-code .c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
.catala-code .cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
.catala-code .gd { color: #A00000 } /* Generic.Deleted */
.catala-code .ge { font-style: italic } /* Generic.Emph */
.catala-code .ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.catala-code .gr { color: #E40000 } /* Generic.Error */
.catala-code .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.catala-code .gi { color: #008400 } /* Generic.Inserted */
.catala-code .go { color: #717171 } /* Generic.Output */
.catala-code .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.catala-code .gs { font-weight: bold } /* Generic.Strong */
.catala-code .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.catala-code .gt { color: #0044DD } /* Generic.Traceback */
.catala-code .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.catala-code .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.catala-code .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.catala-code .kp { color: #008000 } /* Keyword.Pseudo */
.catala-code .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.catala-code .kt { color: #B00040 } /* Keyword.Type */
.catala-code .m { color: #666666 } /* Literal.Number */
.catala-code .s { color: #BA2121 } /* Literal.String */
.catala-code .na { color: #687822 } /* Name.Attribute */
.catala-code .nb { color: #008000 } /* Name.Builtin */
.catala-code .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.catala-code .no { color: #880000 } /* Name.Constant */
.catala-code .nd { color: #AA22FF } /* Name.Decorator */
.catala-code .ni { color: #717171; font-weight: bold } /* Name.Entity */
.catala-code .ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
.catala-code .nf { color: #0000FF } /* Name.Function */
.catala-code .nl { color: #767600 } /* Name.Label */
.catala-code .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.catala-code .nt { color: #008000; font-weight: bold } /* Name.Tag */
.catala-code .nv { color: #19177C } /* Name.Variable */
.catala-code .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.catala-code .w { color: #bbbbbb } /* Text.Whitespace */
.catala-code .mb { color: #666666 } /* Literal.Number.Bin */
.catala-code .mf { color: #666666 } /* Literal.Number.Float */
.catala-code .mh { color: #666666 } /* Literal.Number.Hex */
.catala-code .mi { color: #666666 } /* Literal.Number.Integer */
.catala-code .mo { color: #666666 } /* Literal.Number.Oct */
.catala-code .sa { color: #BA2121 } /* Literal.String.Affix */
.catala-code .sb { color: #BA2121 } /* Literal.String.Backtick */
.catala-code .sc { color: #BA2121 } /* Literal.String.Char */
.catala-code .dl { color: #BA2121 } /* Literal.String.Delimiter */
.catala-code .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.catala-code .s2 { color: #BA2121 } /* Literal.String.Double */
.catala-code .se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
.catala-code .sh { color: #BA2121 } /* Literal.String.Heredoc */
.catala-code .si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
.catala-code .sx { color: #008000 } /* Literal.String.Other */
.catala-code .sr { color: #A45A77 } /* Literal.String.Regex */
.catala-code .s1 { color: #BA2121 } /* Literal.String.Single */
.catala-code .ss { color: #19177C } /* Literal.String.Symbol */
.catala-code .bp { color: #008000 } /* Name.Builtin.Pseudo */
.catala-code .fm { color: #0000FF } /* Name.Function.Magic */
.catala-code .vc { color: #19177C } /* Name.Variable.Class */
.catala-code .vg { color: #19177C } /* Name.Variable.Global */
.catala-code .vi { color: #19177C } /* Name.Variable.Instance */
.catala-code .vm { color: #19177C } /* Name.Variable.Magic */
.catala-code .il { color: #666666 } /* Literal.Number.Integer.Long */

</style>
<meta http-equiv='Content-Type' content='text/html; charset=utf-8'/>
</head>
<body>
<h1>Legislative text implementation<br />
<small>Document generated by Catala version 0.10.0-28-g372058bc</small>
</h1>
<p>This document was produced from a set of source files written in the
Catala programming language, mixing together the legislative text and
the computer code that translates it. For more information about the
methodology and how to read the code, please visit <a
href="https://catala-lang.org">https://catala-lang.org</a>.</p>
<p>
Source files weaved in this document:
</p>
<ul>
<li><tt>tutorial_en.catala_en</tt>, last modification 2024-05-22, 14:27</li>
</ul>

<details class="toc">
  <summary>Table of contents</summary>
  <ol class="toc-0">
    <li class="toc-item">
      <div>
        <a href="#The%20Catala%20language%20tutorial">The Catala language tutorial</a>
        <ol class="toc-1">
          <li class="toc-item">
            <div>
              <a href="#The%20Catala%20language%20tutorial-Literate%20programming">Literate programming</a>
              <ol class="toc-2">
                <li class="toc-item">
                  <div>
                    <a href="#The%20Catala%20language%20tutorial-Literate%20programming-Article%201">Article 1</a>
                    <ol class="toc-3">
                      
                      </ol>
                    </div>
                  </li>
                </ol>
              </div>
            </li>
          <li class="toc-item">
            <div>
              <a href="#The%20Catala%20language%20tutorial-Defining%20a%20fictional%20income%20tax">Defining a fictional income tax</a>
              <ol class="toc-2">
                <li class="toc-item">
                  <div>
                    <a href="#The%20Catala%20language%20tutorial-Defining%20a%20fictional%20income%20tax-Article%201">Article 1</a>
                    <ol class="toc-3">
                      
                      </ol>
                    </div>
                  </li>
                <li class="toc-item">
                  <div>
                    <a href="#The%20Catala%20language%20tutorial-Defining%20a%20fictional%20income%20tax-Article%202">Article 2</a>
                    <ol class="toc-3">
                      
                      </ol>
                    </div>
                  </li>
                </ol>
              </div>
            </li>
          <li class="toc-item">
            <div>
              <a href="#The%20Catala%20language%20tutorial-Conditional%20definitions">Conditional definitions</a>
              <ol class="toc-2">
                <li class="toc-item">
                  <div>
                    <a href="#The%20Catala%20language%20tutorial-Conditional%20definitions-Article%203">Article 3</a>
                    <ol class="toc-3">
                      
                      </ol>
                    </div>
                  </li>
                </ol>
              </div>
            </li>
          <li class="toc-item">
            <div>
              <a href="#The%20Catala%20language%20tutorial-Rules">Rules</a>
              <ol class="toc-2">
                <li class="toc-item">
                  <div>
                    <a href="#The%20Catala%20language%20tutorial-Rules-Article%203%20bis">Article 3 bis</a>
                    <ol class="toc-3">
                      
                      </ol>
                    </div>
                  </li>
                </ol>
              </div>
            </li>
          <li class="toc-item">
            <div>
              <a href="#The%20Catala%20language%20tutorial-Functions">Functions</a>
              <ol class="toc-2">
                <li class="toc-item">
                  <div>
                    <a href="#The%20Catala%20language%20tutorial-Functions-Article%204">Article 4</a>
                    <ol class="toc-3">
                      
                      </ol>
                    </div>
                  </li>
                </ol>
              </div>
            </li>
          <li class="toc-item">
            <div>
              <a href="#The%20Catala%20language%20tutorial-Scope%20inclusion">Scope inclusion</a>
              <ol class="toc-2">
                <li class="toc-item">
                  <div>
                    <a href="#The%20Catala%20language%20tutorial-Scope%20inclusion-Article%205">Article 5</a>
                    <ol class="toc-3">
                      
                      </ol>
                    </div>
                  </li>
                <li class="toc-item">
                  <div>
                    <a href="#The%20Catala%20language%20tutorial-Scope%20inclusion-Article%206">Article 6</a>
                    <ol class="toc-3">
                      
                      </ol>
                    </div>
                  </li>
                </ol>
              </div>
            </li>
          <li class="toc-item">
            <div>
              <a href="#The%20Catala%20language%20tutorial-Testing%20Catala%20programs">Testing Catala programs</a>
              <ol class="toc-2">
                <li class="toc-item">
                  <div>
                    <a href="#The%20Catala%20language%20tutorial-Testing%20Catala%20programs-Testing%20NewIncomeTaxComputation">Testing NewIncomeTaxComputation</a>
                    <ol class="toc-3">
                      
                      </ol>
                    </div>
                  </li>
                </ol>
              </div>
            </li>
          <li class="toc-item">
            <div>
              <a href="#The%20Catala%20language%20tutorial-Defining%20exceptions%20to%20rules">Defining exceptions to rules</a>
              <ol class="toc-2">
                <li class="toc-item">
                  <div>
                    <a href="#The%20Catala%20language%20tutorial-Defining%20exceptions%20to%20rules-Fixing%20the%20computation">Fixing the computation</a>
                    <ol class="toc-3">
                      
                      </ol>
                    </div>
                  </li>
                <li class="toc-item">
                  <div>
                    <a href="#The%20Catala%20language%20tutorial-Defining%20exceptions%20to%20rules-Defining%20exceptions%20to%20groups%20of%20rules">Defining exceptions to groups of rules</a>
                    <ol class="toc-3">
                      
                      </ol>
                    </div>
                  </li>
                <li class="toc-item">
                  <div>
                    <a href="#The%20Catala%20language%20tutorial-Defining%20exceptions%20to%20rules-Cumulative%20exceptions">Cumulative exceptions</a>
                    <ol class="toc-3">
                      <li class="toc-item">
                        <div>
                          <a href="#The%20Catala%20language%20tutorial-Defining%20exceptions%20to%20rules-Cumulative%20exceptions-Article%206%20bis">Article 6 bis</a>
                          <ol class="toc-4">
                            
                            </ol>
                          </div>
                        </li>
                      </ol>
                    </div>
                  </li>
                <li class="toc-item">
                  <div>
                    <a href="#The%20Catala%20language%20tutorial-Defining%20exceptions%20to%20rules-Direct%20scope%20calls">Direct scope calls</a>
                    <ol class="toc-3">
                      
                      </ol>
                    </div>
                  </li>
                <li class="toc-item">
                  <div>
                    <a href="#The%20Catala%20language%20tutorial-Defining%20exceptions%20to%20rules-Implicit%20scope%20structures,%20and%20output%20scopes">Implicit scope structures, and output scopes</a>
                    <ol class="toc-3">
                      
                      </ol>
                    </div>
                  </li>
                </ol>
              </div>
            </li>
          <li class="toc-item">
            <div>
              <a href="#The%20Catala%20language%20tutorial-Context%20scope%20variables">Context scope variables</a>
              <ol class="toc-2">
                <li class="toc-item">
                  <div>
                    <a href="#The%20Catala%20language%20tutorial-Context%20scope%20variables-Article%207">Article 7</a>
                    <ol class="toc-3">
                      
                      </ol>
                    </div>
                  </li>
                </ol>
              </div>
            </li>
          <li class="toc-item">
            <div>
              <a href="#The%20Catala%20language%20tutorial-One%20variable,%20multiple%20states">One variable, multiple states</a>
              <ol class="toc-2">
                <li class="toc-item">
                  <div>
                    <a href="#The%20Catala%20language%20tutorial-One%20variable,%20multiple%20states-Article%208">Article 8</a>
                    <ol class="toc-3">
                      <li class="toc-item">
                        <div>
                          <a href="#The%20Catala%20language%20tutorial-One%20variable,%20multiple%20states-Article%208-Accessing%20states">Accessing states</a>
                          <ol class="toc-4">
                            
                            </ol>
                          </div>
                        </li>
                      </ol>
                    </div>
                  </li>
                </ol>
              </div>
            </li>
          <li class="toc-item">
            <div>
              <a href="#The%20Catala%20language%20tutorial-Catala%20values">Catala values</a>
              <ol class="toc-2">
                <li class="toc-item">
                  <div>
                    <a href="#The%20Catala%20language%20tutorial-Catala%20values-Booleans">Booleans</a>
                    <ol class="toc-3">
                      
                      </ol>
                    </div>
                  </li>
                <li class="toc-item">
                  <div>
                    <a href="#The%20Catala%20language%20tutorial-Catala%20values-Integers">Integers</a>
                    <ol class="toc-3">
                      
                      </ol>
                    </div>
                  </li>
                <li class="toc-item">
                  <div>
                    <a href="#The%20Catala%20language%20tutorial-Catala%20values-Decimals">Decimals</a>
                    <ol class="toc-3">
                      
                      </ol>
                    </div>
                  </li>
                <li class="toc-item">
                  <div>
                    <a href="#The%20Catala%20language%20tutorial-Catala%20values-Money">Money</a>
                    <ol class="toc-3">
                      
                      </ol>
                    </div>
                  </li>
                <li class="toc-item">
                  <div>
                    <a href="#The%20Catala%20language%20tutorial-Catala%20values-Dates%20and%20durations">Dates and durations</a>
                    <ol class="toc-3">
                      <li class="toc-item">
                        <div>
                          <a href="#The%20Catala%20language%20tutorial-Catala%20values-Dates%20and%20durations-Ambiguities">Ambiguities</a>
                          <ol class="toc-4">
                            
                            </ol>
                          </div>
                        </li>
                      </ol>
                    </div>
                  </li>
                <li class="toc-item">
                  <div>
                    <a href="#The%20Catala%20language%20tutorial-Catala%20values-Lists">Lists</a>
                    <ol class="toc-3">
                      
                      </ol>
                    </div>
                  </li>
                <li class="toc-item">
                  <div>
                    <a href="#The%20Catala%20language%20tutorial-Catala%20values-Tuples">Tuples</a>
                    <ol class="toc-3">
                      
                      </ol>
                    </div>
                  </li>
                </ol>
              </div>
            </li>
          <li class="toc-item">
            <div>
              <a href="#The%20Catala%20language%20tutorial-Conclusion">Conclusion</a>
              <ol class="toc-2">
                
                </ol>
              </div>
            </li>
          </ol>
        </div>
      </li>
    <li class="toc-item">
      <div>
        <a href="#Annex%20A:%20top-level%20value%20definitions">Annex A: top-level value definitions</a>
        <ol class="toc-1">
          <li class="toc-item">
            <div>
              <a href="#Annex%20A:%20top-level%20value%20definitions-Examples">Examples</a>
              <ol class="toc-2">
                <li class="toc-item">
                  <div>
                    <a href="#Annex%20A:%20top-level%20value%20definitions-Examples-Defining%20a%20constant">Defining a constant</a>
                    <ol class="toc-3">
                      
                      </ol>
                    </div>
                  </li>
                <li class="toc-item">
                  <div>
                    <a href="#Annex%20A:%20top-level%20value%20definitions-Examples-Defining%20a%20function%20with%20a%20single%20argument">Defining a function with a single argument</a>
                    <ol class="toc-3">
                      
                      </ol>
                    </div>
                  </li>
                <li class="toc-item">
                  <div>
                    <a href="#Annex%20A:%20top-level%20value%20definitions-Examples-Functions%20with%20multiple%20parameters">Functions with multiple parameters</a>
                    <ol class="toc-3">
                      
                      </ol>
                    </div>
                  </li>
                </ol>
              </div>
            </li>
          </ol>
        </div>
      </li>
    <li class="toc-item">
      <div>
        <a href="#Annex%20B:%20modules">Annex B: modules</a>
        <ol class="toc-1">
          <li class="toc-item">
            <div>
              <a href="#Annex%20B:%20modules-Declaring%20a%20module">Declaring a module</a>
              <ol class="toc-2">
                
                </ol>
              </div>
            </li>
          <li class="toc-item">
            <div>
              <a href="#Annex%20B:%20modules-Using%20modules">Using modules</a>
              <ol class="toc-2">
                
                </ol>
              </div>
            </li>
          </ol>
        </div>
      </li>
    </ol>
  </details>
<h1 class='law-heading' id="The%20Catala%20language%20tutorial"><a href="#The%20Catala%20language%20tutorial">The Catala language tutorial</a></h1>

<div class='law-text'><p>Welcome to this tutorial, whose objective is to guide you through the
features of the Catala language and teach you how to annotate a
legislative text using the language. This document is addressed
primarily to developers or people that have a programming background,
though tech-savvy lawyers will probably figure things out.</p></div>
<div class='code-wrapper catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-10">10</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-11">11</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-12">12</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-13">13</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-14">14</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-15">15</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-16">16</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-17">17</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-18">18</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-19">19</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-20">20</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-21">21</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-22">22</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-23">23</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-24">24</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-25">25</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-10" name="tutorial_en/tutorial_en.catala_en-10"></a><span class="c1"># Welcome to the code mode of Catala. This is a comment, because the line is</span>
<a id="tutorial_en/tutorial_en.catala_en-11" name="tutorial_en/tutorial_en.catala_en-11"></a><span class="c1"># prefixed by #.</span>
<a id="tutorial_en/tutorial_en.catala_en-12" name="tutorial_en/tutorial_en.catala_en-12"></a>
<a id="tutorial_en/tutorial_en.catala_en-13" name="tutorial_en/tutorial_en.catala_en-13"></a><span class="c1"># This tutorial does not cover the installation of Catala. For more</span>
<a id="tutorial_en/tutorial_en.catala_en-14" name="tutorial_en/tutorial_en.catala_en-14"></a><span class="c1"># information about this, please refer the readme at:</span>
<a id="tutorial_en/tutorial_en.catala_en-15" name="tutorial_en/tutorial_en.catala_en-15"></a><span class="c1"># https://github.com/CatalaLang/catala#building-and-installation</span>
<a id="tutorial_en/tutorial_en.catala_en-16" name="tutorial_en/tutorial_en.catala_en-16"></a>
<a id="tutorial_en/tutorial_en.catala_en-17" name="tutorial_en/tutorial_en.catala_en-17"></a><span class="c1"># If you want to get started with your own Catala program to follow this</span>
<a id="tutorial_en/tutorial_en.catala_en-18" name="tutorial_en/tutorial_en.catala_en-18"></a><span class="c1"># tutorial, simply create an empty file with the extension .catala_en</span>
<a id="tutorial_en/tutorial_en.catala_en-19" name="tutorial_en/tutorial_en.catala_en-19"></a><span class="c1"># and start typing your program.</span>
<a id="tutorial_en/tutorial_en.catala_en-20" name="tutorial_en/tutorial_en.catala_en-20"></a>
<a id="tutorial_en/tutorial_en.catala_en-21" name="tutorial_en/tutorial_en.catala_en-21"></a><span class="c1"># For a complete reference of the Catala syntax, see:</span>
<a id="tutorial_en/tutorial_en.catala_en-22" name="tutorial_en/tutorial_en.catala_en-22"></a><span class="c1"># https://catalalang.github.io/catala/syntax.pdf</span>
<a id="tutorial_en/tutorial_en.catala_en-23" name="tutorial_en/tutorial_en.catala_en-23"></a>
<a id="tutorial_en/tutorial_en.catala_en-24" name="tutorial_en/tutorial_en.catala_en-24"></a><span class="c1"># This tutorial itself is written as a Catala program and can be accessed at:</span>
<a id="tutorial_en/tutorial_en.catala_en-25" name="tutorial_en/tutorial_en.catala_en-25"></a><span class="c1"># https://github.com/CatalaLang/catala-examples/tree/master/tutorial_en</span>
</pre></div></td></tr></table></div>

</div>

<h2 class='law-heading' id="The%20Catala%20language%20tutorial-Literate%20programming"><a href="#The%20Catala%20language%20tutorial-Literate%20programming">Literate programming</a></h2>
<details><summary>Literate programming</summary>
<div class='law-text'><p>To begin writing a Catala program, you must start from the text of
the legislative source that will justify the code that you will write.
Concretely, that means copy-pasting the text of the law into a Catala
source file and formatting it according so that Catala can understand
it. Catala source files have the “.catala_en” extension. If you were to
write a Catala program for a French law, you would use the “.catala_fr”
extension; for Polish law, “catala_pl”, etc.</p>
<p>You can write any kind of plain text in Catala, and it will be
printed as is in PDF or HTML output. You can split your text into short
lines of less than 80 characters, terminal-style, and those will appear
as a single paragraph in the output. If you want to create a new
paragraph, you have to leave a blank line in the source. The syntax for
non-code text in a Catala program follows a subset of Markdown that
supports titles and Catala block codes.</p>
<p>Catala allows you to declare section or subsection headers as it is
done here, with the “#” symbol. You can define heading of lower
importance by adding increasing numbers of “#” after the title of the
heading. Generally, the literate programming syntax of Catala follows
the syntax of Markdown (though it does not have all of its
features).</p>
<p>In the rest of this tutorial, we will analyze a fictional example
that defines an income tax. This income tax is defined through several
articles of law, each of them introduced by a header. Here is the first
one:</p></div>
<h3 class='law-heading' id="The%20Catala%20language%20tutorial-Literate%20programming-Article%201"><a href="#The%20Catala%20language%20tutorial-Literate%20programming-Article%201">Article 1</a></h3>

<div class='law-text'><p>The income tax for an individual is defined as a fixed percentage of
the individual’s income over a year.</p></div>
<div class='code-wrapper catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-61">61</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-62">62</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-63">63</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-64">64</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-65">65</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-61" name="tutorial_en/tutorial_en.catala_en-61"></a><span class="c1"># We will soon learn what to write here in order to translate the meaning</span>
<a id="tutorial_en/tutorial_en.catala_en-62" name="tutorial_en/tutorial_en.catala_en-62"></a><span class="c1"># of the article into Catala code.</span>
<a id="tutorial_en/tutorial_en.catala_en-63" name="tutorial_en/tutorial_en.catala_en-63"></a>
<a id="tutorial_en/tutorial_en.catala_en-64" name="tutorial_en/tutorial_en.catala_en-64"></a><span class="c1"># To create a block of Catala code in your file, bound it with Mardown-style</span>
<a id="tutorial_en/tutorial_en.catala_en-65" name="tutorial_en/tutorial_en.catala_en-65"></a><span class="c1"># &quot;```catala&quot; and &quot;```&quot; delimiters.</span>
</pre></div></td></tr></table></div>

</div>
<div class='law-text'><p>To translate that fictional income tax definition into a Catala
program, we will intertwine short snippets of code between the sentences
of the legislative text. Each snippet of code should be as short as
possible and as close as possible to the actual sentence that justifies
the code. This style is called literate programming, a programming
paradigm invented by the famous computer scientist Donald Knuth in the
70s.</p></div>

</details>
<h2 class='law-heading' id="The%20Catala%20language%20tutorial-Defining%20a%20fictional%20income%20tax"><a href="#The%20Catala%20language%20tutorial-Defining%20a%20fictional%20income%20tax">Defining a fictional income tax</a></h2>
<details><summary>Defining a fictional income tax</summary>
<div class='law-text'><p>The content of article 1 uses a lot of implicit context: there exists
an individual with an income, as well as an income tax that the
individual has to pay each year. Even if this implicit context is not
verbatim in the law, we have to explicit it for programming purposes.
Concretely, we need a “metadata” section that defines the shape and
types of the data used inside the law.</p>
<p>Let’s start our metadata section by declaring the type information
for the individual, the taxpayer that will be the subject of the tax
computation. This individual has an income and a number of children,
both pieces of information which will be needed for tax purposes :</p></div>
<div class='code-wrapper code-metadata catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-90"> 90</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-91"> 91</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-92"> 92</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-93"> 93</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-94"> 94</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-95"> 95</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-96"> 96</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-97"> 97</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-98"> 98</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-99"> 99</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-100">100</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-90" name="tutorial_en/tutorial_en.catala_en-90"></a><span class="kr">declaration</span><span class="s"> </span><span class="kt">structure</span><span class="s"> </span><span class="nc">Individual</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-91" name="tutorial_en/tutorial_en.catala_en-91"></a><span class="c1">  # The name of the structure &quot;Individual&quot;, must start with an</span>
<a id="tutorial_en/tutorial_en.catala_en-92" name="tutorial_en/tutorial_en.catala_en-92"></a><span class="c1">  # uppercase letter: this is the CamelCase convention.</span>
<a id="tutorial_en/tutorial_en.catala_en-93" name="tutorial_en/tutorial_en.catala_en-93"></a><span class="s">  </span><span class="kr">data</span><span class="s"> </span><span class="nv">income</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">money</span>
<a id="tutorial_en/tutorial_en.catala_en-94" name="tutorial_en/tutorial_en.catala_en-94"></a><span class="c1">  # In this line, &quot;income&quot; is the name of the structure field and</span>
<a id="tutorial_en/tutorial_en.catala_en-95" name="tutorial_en/tutorial_en.catala_en-95"></a><span class="c1">  # &quot;money&quot; is the type of what is stored in that field.</span>
<a id="tutorial_en/tutorial_en.catala_en-96" name="tutorial_en/tutorial_en.catala_en-96"></a><span class="c1">  # Available types include: integer, decimal, money, date, duration,</span>
<a id="tutorial_en/tutorial_en.catala_en-97" name="tutorial_en/tutorial_en.catala_en-97"></a><span class="c1">  # and any other structure or enumeration that you declare.</span>
<a id="tutorial_en/tutorial_en.catala_en-98" name="tutorial_en/tutorial_en.catala_en-98"></a><span class="s">  </span><span class="kr">data</span><span class="s"> </span><span class="nv">number_of_children</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">integer</span>
<a id="tutorial_en/tutorial_en.catala_en-99" name="tutorial_en/tutorial_en.catala_en-99"></a><span class="c1">  # &quot;income&quot; and &quot;number_of_children&quot; start by a lowercase letter,</span>
<a id="tutorial_en/tutorial_en.catala_en-100" name="tutorial_en/tutorial_en.catala_en-100"></a><span class="c1">  # they follow the snake_case convention.</span>
</pre></div></td></tr></table></div>

</div>
<div class='law-text'><p>This structure contains two data fields, “income” and
“number_of_children”. Structures are useful to group together data that
goes together. Usually, you get one structure per concrete object on
which the law applies (like the individual). It is up to you to decide
how to group the data together, but you should aim to optimize code
readability.</p>
<p>Sometimes, the law gives an enumeration of different situations.
These enumerations are modeled in Catala using an enumeration type,
like:</p></div>
<div class='code-wrapper code-metadata catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-113">113</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-114">114</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-115">115</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-116">116</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-117">117</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-118">118</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-119">119</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-120">120</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-121">121</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-122">122</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-113" name="tutorial_en/tutorial_en.catala_en-113"></a><span class="kr">declaration</span><span class="s"> </span><span class="kt">enumeration</span><span class="s"> </span><span class="nc">TaxCredit</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-114" name="tutorial_en/tutorial_en.catala_en-114"></a><span class="c1"># The name &quot;TaxCredit&quot; is also written in CamelCase.</span>
<a id="tutorial_en/tutorial_en.catala_en-115" name="tutorial_en/tutorial_en.catala_en-115"></a><span class="o">--</span><span class="s"> </span><span class="nc">NoTaxCredit</span>
<a id="tutorial_en/tutorial_en.catala_en-116" name="tutorial_en/tutorial_en.catala_en-116"></a><span class="c1"># This line says that &quot;TaxCredit&quot; can be a &quot;NoTaxCredit&quot; situation.</span>
<a id="tutorial_en/tutorial_en.catala_en-117" name="tutorial_en/tutorial_en.catala_en-117"></a><span class="o">--</span><span class="s"> </span><span class="nc">ChildrenTaxCredit</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">integer</span>
<a id="tutorial_en/tutorial_en.catala_en-118" name="tutorial_en/tutorial_en.catala_en-118"></a><span class="c1"># This line says that alternatively, &quot;TaxCredit&quot; can be a</span>
<a id="tutorial_en/tutorial_en.catala_en-119" name="tutorial_en/tutorial_en.catala_en-119"></a><span class="c1"># &quot;ChildrenTaxCredit&quot; situation. This situation carries a content</span>
<a id="tutorial_en/tutorial_en.catala_en-120" name="tutorial_en/tutorial_en.catala_en-120"></a><span class="c1"># of type integer corresponding to the number of children concerned</span>
<a id="tutorial_en/tutorial_en.catala_en-121" name="tutorial_en/tutorial_en.catala_en-121"></a><span class="c1"># by the tax credit. This means that if you&#39;re in the &quot;ChildrenTaxCredit&quot;</span>
<a id="tutorial_en/tutorial_en.catala_en-122" name="tutorial_en/tutorial_en.catala_en-122"></a><span class="c1"># situation, you will also have access to this number of children.</span>
</pre></div></td></tr></table></div>

</div>
<div class='law-text'><p>In computer science terms, such an enumeration is called a “sum type”
or simply an enum. The combination of structures and enumerations allow
the Catala programmer to declare all possible shapes of data, as they
are equivalent to the powerful notion of “algebraic data types”.</p>
<p>We’ve defined and typed the data that the program will manipulate.
Now we have to define the logical context in which this data will
evolve. This is done in Catala using “scopes”. Scopes are close to
functions in terms of traditional programming. Scopes also have to be
declared in metadata, so here we go:</p></div>
<div class='code-wrapper code-metadata catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-136">136</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-137">137</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-138">138</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-139">139</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-140">140</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-141">141</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-142">142</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-143">143</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-136" name="tutorial_en/tutorial_en.catala_en-136"></a><span class="kr">declaration</span><span class="s"> </span><span class="kr">scope</span><span class="s"> </span><span class="nc">IncomeTaxComputation</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-137" name="tutorial_en/tutorial_en.catala_en-137"></a><span class="c1">  # Scope names use CamelCase.</span>
<a id="tutorial_en/tutorial_en.catala_en-138" name="tutorial_en/tutorial_en.catala_en-138"></a><span class="s">  </span><span class="kd">input</span><span class="s"> </span><span class="nv">individual</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="nc">Individual</span>
<a id="tutorial_en/tutorial_en.catala_en-139" name="tutorial_en/tutorial_en.catala_en-139"></a><span class="c1">  # This line declares a scope variable of the scope, which is akin to</span>
<a id="tutorial_en/tutorial_en.catala_en-140" name="tutorial_en/tutorial_en.catala_en-140"></a><span class="c1">  # a function parameter in computer science term. This is the piece of</span>
<a id="tutorial_en/tutorial_en.catala_en-141" name="tutorial_en/tutorial_en.catala_en-141"></a><span class="c1">  # data on which the scope will operate.</span>
<a id="tutorial_en/tutorial_en.catala_en-142" name="tutorial_en/tutorial_en.catala_en-142"></a><span class="s">  </span><span class="kd">internal</span><span class="s"> </span><span class="nv">fixed_percentage</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">decimal</span>
<a id="tutorial_en/tutorial_en.catala_en-143" name="tutorial_en/tutorial_en.catala_en-143"></a><span class="s">  </span><span class="kd">output</span><span class="s"> </span><span class="nv">income_tax</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">money</span>
</pre></div></td></tr></table></div>

</div>
<div class='law-text'><p>The scope is the basic abstraction unit in Catala programs, and the
declaration of the scope is akin to a function signature: it contains a
list of all the arguments along with their types. But in Catala, scopes’
variables stand for three things: input arguments, local variables and
outputs. The difference between these three categories can be specified
by the different input/output attributes preceding the variable names.
“input” means that the variable has to be defined only when the scope
IncomeTaxComputation is called. “internal” means that the variable
cannot be seen from outside the scope: it is neither an input nor an
output of the scope. “output” means that a caller scope can retrieve the
computed value of the variable. Note that a variable can also be
simulataneously an input and an output of the scope, in that case it
should be annotated with “input output”.</p>
<p>We now have everything to annotate the contents of article 1, which
is copied over below.</p></div>
<h3 class='law-heading' id="The%20Catala%20language%20tutorial-Defining%20a%20fictional%20income%20tax-Article%201"><a href="#The%20Catala%20language%20tutorial-Defining%20a%20fictional%20income%20tax-Article%201">Article 1</a></h3>

<div class='law-text'><p>The income tax for an individual is defined as a fixed percentage of
the individual’s income over a year.</p></div>
<div class='code-wrapper catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-168">168</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-169">169</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-170">170</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-168" name="tutorial_en/tutorial_en.catala_en-168"></a><span class="kr">scope</span><span class="s"> </span><span class="nc">IncomeTaxComputation</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-169" name="tutorial_en/tutorial_en.catala_en-169"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">income_tax</span><span class="s"> </span><span class="kr">equals</span>
<a id="tutorial_en/tutorial_en.catala_en-170" name="tutorial_en/tutorial_en.catala_en-170"></a><span class="s">    </span><span class="nv">individual</span><span class="o">.</span><span class="s">income </span><span class="o">*</span><span class="s"> </span><span class="nv">fixed_percentage</span>
</pre></div></td></tr></table></div>

</div>
<div class='law-text'><p>In the code, we are defining inside our scope the amount of the
income tax according to the formula described in the article. When
defining formulas, you have access to all the usual arithmetic
operators: addition “+”, subtraction “-”, multiplication “*” and
division (slash).</p>
<p>However, in the Catala code, you should be aware that these operators
can behave differently depending on the quantities considered: indeed,
money for example is rounded at the cent. The Catala compiler is able to
automatically select the appropriate operation: here it can detect that
money is being multiplied by a decimal which is a known operation that
yields an amount of money, rounded at the cent. Some other operations
are not allowed, like multiplying two amounts of money together, or
adding two dates.</p>
<p>Coming back to article 1, one question remains unknown: what is the
value of the fixed percentage? Often, precise values are defined
elsewhere in the legislative source. Here, let’s suppose we have:</p></div>

<h3 class='law-heading' id="The%20Catala%20language%20tutorial-Defining%20a%20fictional%20income%20tax-Article%202"><a href="#The%20Catala%20language%20tutorial-Defining%20a%20fictional%20income%20tax-Article%202">Article 2</a></h3>

<div class='law-text'><p>The fixed percentage mentioned at article 1 is equal to 20 %.</p></div>
<div class='code-wrapper catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-195">195</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-196">196</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-197">197</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-195" name="tutorial_en/tutorial_en.catala_en-195"></a><span class="kr">scope</span><span class="s"> </span><span class="nc">IncomeTaxComputation</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-196" name="tutorial_en/tutorial_en.catala_en-196"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">fixed_percentage</span><span class="s"> </span><span class="kr">equals</span><span class="s"> </span><span class="mi">20</span><span class="s"> </span><span class="o">%</span>
<a id="tutorial_en/tutorial_en.catala_en-197" name="tutorial_en/tutorial_en.catala_en-197"></a><span class="c1">  # Writing 20% is just an abbreviation for &quot;0.20&quot;.</span>
</pre></div></td></tr></table></div>

</div>
<div class='law-text'><p>You can see here that Catala allows definitions to be scattered
throughout the annotation of the legislative text, so that each
definition is as close as possible to its location in the text.</p></div>

</details>
<h2 class='law-heading' id="The%20Catala%20language%20tutorial-Conditional%20definitions"><a href="#The%20Catala%20language%20tutorial-Conditional%20definitions">Conditional definitions</a></h2>
<details><summary>Conditional definitions</summary>
<div class='law-text'><p>So far so good, but now the legislative text introduces some
trickiness. Let us suppose the third article says:</p></div>
<h3 class='law-heading' id="The%20Catala%20language%20tutorial-Conditional%20definitions-Article%203"><a href="#The%20Catala%20language%20tutorial-Conditional%20definitions-Article%203">Article 3</a></h3>

<div class='law-text'><p>If the individual is in charge of 2 or more children, then the fixed
percentage mentioned at article 1 is equal to 15 %.</p></div>
<div class='code-wrapper catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-215">215</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-215" name="tutorial_en/tutorial_en.catala_en-215"></a><span class="c1"># How to redefine fixed_percentage?</span>
</pre></div></td></tr></table></div>

</div>
<div class='law-text'><p>This article actually gives another definition for the fixed
percentage, which was already defined in article 2. However, article 3
defines the percentage conditionally to the individual having more than
2 children. Catala allows you precisely to redefine a variable under a
condition:</p></div>
<div class='code-wrapper catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-224">224</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-225">225</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-226">226</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-227">227</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-228">228</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-224" name="tutorial_en/tutorial_en.catala_en-224"></a><span class="kr">scope</span><span class="s"> </span><span class="nc">IncomeTaxComputation</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-225" name="tutorial_en/tutorial_en.catala_en-225"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">fixed_percentage</span><span class="s"> </span><span class="kr">under condition</span>
<a id="tutorial_en/tutorial_en.catala_en-226" name="tutorial_en/tutorial_en.catala_en-226"></a><span class="s">    </span><span class="nv">individual</span><span class="o">.</span><span class="s">number_of_children </span><span class="o">&gt;=</span><span class="s"> </span><span class="mi">2</span>
<a id="tutorial_en/tutorial_en.catala_en-227" name="tutorial_en/tutorial_en.catala_en-227"></a><span class="s">  </span><span class="kr">consequence</span><span class="s"> </span><span class="kr">equals</span><span class="s"> </span><span class="mi">15</span><span class="s"> </span><span class="o">%</span>
<a id="tutorial_en/tutorial_en.catala_en-228" name="tutorial_en/tutorial_en.catala_en-228"></a><span class="c1">  # Writing 15% is just an abbreviation for &quot;0.15&quot;.</span>
</pre></div></td></tr></table></div>

</div>
<div class='law-text'><p>While conditional definitions are a powerful tool for expressing
legal conditions, a correctly drafted legislative source should always
ensure that at most one condition is true at all times. This way, when
the Catala program is executed, the right definition will be dynamically
chosen by looking at which condition is true.</p>
<p>Here, however, our definition of <code>fixed_percentage</code>
conflicts with the more general definition that we gave above—so Catala
will give us an error if we try and use this definition as is. In
situations like this, Catala allows us to define a precedence on the
conditions, which has to be justified by the law. But we will see how to
do that later.</p></div>

</details>
<h2 class='law-heading' id="The%20Catala%20language%20tutorial-Rules"><a href="#The%20Catala%20language%20tutorial-Rules">Rules</a></h2>
<details><summary>Rules</summary>
<div class='law-text'><p>So far, you’ve learnt how to declare a scope with some variables, and
give definitions to these variables scattered accross the text of the
law at the relevant locations. But there is a pattern very frequent in
legislative texts: what about conditions? A condition is a value that
can be either true or false, like a boolean in programming. However, the
law implicitly assumes a condition is false unless specified otherwise.
This pattern is so common in law that Catala gives it a special syntax.
More precisely, it calls the definition of conditions “rules”, which
coincides with the usual meaning law people would give it.</p>
<p>Here is an example of a condition that might arise in the law:</p></div>
<h3 class='law-heading' id="The%20Catala%20language%20tutorial-Rules-Article%203%20bis"><a href="#The%20Catala%20language%20tutorial-Rules-Article%203%20bis">Article 3 bis</a></h3>

<div class='law-text'><p>The children eligible for application of article 3</p></div>
<div class='code-wrapper catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-261">261</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-262">262</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-263">263</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-264">264</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-265">265</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-266">266</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-267">267</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-268">268</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-269">269</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-270">270</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-271">271</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-272">272</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-273">273</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-261" name="tutorial_en/tutorial_en.catala_en-261"></a><span class="c1"># To deal with children eligibility, we create a new scope.</span>
<a id="tutorial_en/tutorial_en.catala_en-262" name="tutorial_en/tutorial_en.catala_en-262"></a><span class="kr">declaration</span><span class="s"> </span><span class="kr">scope</span><span class="s"> </span><span class="nc">Child</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-263" name="tutorial_en/tutorial_en.catala_en-263"></a><span class="s">  </span><span class="kd">input</span><span class="s"> </span><span class="nv">age</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">integer</span>
<a id="tutorial_en/tutorial_en.catala_en-264" name="tutorial_en/tutorial_en.catala_en-264"></a><span class="c1">  # The age of the child can be declared as before.</span>
<a id="tutorial_en/tutorial_en.catala_en-265" name="tutorial_en/tutorial_en.catala_en-265"></a><span class="s">  </span><span class="kd">output</span><span class="s"> </span><span class="nv">is_eligible_article_3</span><span class="s"> </span><span class="kr">condition</span>
<a id="tutorial_en/tutorial_en.catala_en-266" name="tutorial_en/tutorial_en.catala_en-266"></a><span class="c1">  # For we declare the eligibility using the special &quot;condition&quot; keyword</span>
<a id="tutorial_en/tutorial_en.catala_en-267" name="tutorial_en/tutorial_en.catala_en-267"></a><span class="c1">  # that stands for the content of the variable.</span>
<a id="tutorial_en/tutorial_en.catala_en-268" name="tutorial_en/tutorial_en.catala_en-268"></a>
<a id="tutorial_en/tutorial_en.catala_en-269" name="tutorial_en/tutorial_en.catala_en-269"></a><span class="kr">scope</span><span class="s"> </span><span class="nc">Child</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-270" name="tutorial_en/tutorial_en.catala_en-270"></a><span class="s">  </span><span class="kr">rule</span><span class="s"> </span><span class="nv">is_eligible_article_3</span><span class="s"> </span><span class="kr">under condition</span><span class="s"> </span><span class="nv">age</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="mi">18</span><span class="s"> </span><span class="kr">consequence</span><span class="s"> </span><span class="kr">fulfilled</span>
<a id="tutorial_en/tutorial_en.catala_en-271" name="tutorial_en/tutorial_en.catala_en-271"></a><span class="c1">  # When defining when a condition is true, we use the special &quot;rule&quot; syntax</span>
<a id="tutorial_en/tutorial_en.catala_en-272" name="tutorial_en/tutorial_en.catala_en-272"></a><span class="c1">  # instead of &quot;definition&quot;. Rules set conditions to be &quot;fulfilled&quot; or</span>
<a id="tutorial_en/tutorial_en.catala_en-273" name="tutorial_en/tutorial_en.catala_en-273"></a><span class="c1">  # &quot;not fulfilled&quot; conditionally.</span>
</pre></div></td></tr></table></div>

</div>
<div class='law-text'><p>When interacting with other elements of the code, condition values
behaves like boolean values.</p></div>

</details>
<h2 class='law-heading' id="The%20Catala%20language%20tutorial-Functions"><a href="#The%20Catala%20language%20tutorial-Functions">Functions</a></h2>
<details><summary>Functions</summary>
<div class='law-text'><p>Catala lets you define functions anywhere in your scope variable.
Indeed, Catala is a functional language and encourages using functions
to describe relationships between data. Here’s what it looks like in the
metadata definition when we want to define a two-brackets tax
computation:</p></div>
<div class='code-wrapper code-metadata catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-288">288</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-289">289</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-290">290</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-291">291</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-292">292</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-293">293</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-294">294</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-295">295</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-296">296</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-297">297</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-298">298</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-299">299</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-300">300</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-301">301</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-302">302</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-288" name="tutorial_en/tutorial_en.catala_en-288"></a><span class="kr">declaration</span><span class="s"> </span><span class="kt">structure</span><span class="s"> </span><span class="nc">TwoBrackets</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-289" name="tutorial_en/tutorial_en.catala_en-289"></a><span class="s">  </span><span class="kr">data</span><span class="s"> </span><span class="nv">breakpoint</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">money</span>
<a id="tutorial_en/tutorial_en.catala_en-290" name="tutorial_en/tutorial_en.catala_en-290"></a><span class="s">  </span><span class="kr">data</span><span class="s"> </span><span class="nv">rate1</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">decimal</span>
<a id="tutorial_en/tutorial_en.catala_en-291" name="tutorial_en/tutorial_en.catala_en-291"></a><span class="s">  </span><span class="kr">data</span><span class="s"> </span><span class="nv">rate2</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">decimal</span>
<a id="tutorial_en/tutorial_en.catala_en-292" name="tutorial_en/tutorial_en.catala_en-292"></a><span class="c1"># This structure describes the parameters of a tax computation formula that</span>
<a id="tutorial_en/tutorial_en.catala_en-293" name="tutorial_en/tutorial_en.catala_en-293"></a><span class="c1"># has two tax brackets, each with their own tax rate.</span>
<a id="tutorial_en/tutorial_en.catala_en-294" name="tutorial_en/tutorial_en.catala_en-294"></a>
<a id="tutorial_en/tutorial_en.catala_en-295" name="tutorial_en/tutorial_en.catala_en-295"></a><span class="kr">declaration</span><span class="s"> </span><span class="kr">scope</span><span class="s"> </span><span class="nc">TwoBracketsTaxComputation</span><span class="s"> </span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-296" name="tutorial_en/tutorial_en.catala_en-296"></a><span class="s">  </span><span class="kd">input</span><span class="s"> </span><span class="nv">brackets</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="nc">TwoBrackets</span>
<a id="tutorial_en/tutorial_en.catala_en-297" name="tutorial_en/tutorial_en.catala_en-297"></a><span class="c1">  # This input variable contains the description of the</span>
<a id="tutorial_en/tutorial_en.catala_en-298" name="tutorial_en/tutorial_en.catala_en-298"></a><span class="c1">  # parameters of the tax formula.</span>
<a id="tutorial_en/tutorial_en.catala_en-299" name="tutorial_en/tutorial_en.catala_en-299"></a><span class="s">  </span><span class="kd">output</span><span class="s"> </span><span class="nv">tax_formula</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">money</span><span class="s"> </span><span class="kr">depends on</span><span class="s"> </span><span class="nv">income</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">money</span>
<a id="tutorial_en/tutorial_en.catala_en-300" name="tutorial_en/tutorial_en.catala_en-300"></a><span class="c1">  # But for declaring the tax_formula variable, we declare it as</span>
<a id="tutorial_en/tutorial_en.catala_en-301" name="tutorial_en/tutorial_en.catala_en-301"></a><span class="c1">  # a function: &quot;content money depends on income content money&quot; means a function</span>
<a id="tutorial_en/tutorial_en.catala_en-302" name="tutorial_en/tutorial_en.catala_en-302"></a><span class="c1">  # that returns money as output (the tax) and takes the income money as input.</span>
</pre></div></td></tr></table></div>

</div>

<h3 class='law-heading' id="The%20Catala%20language%20tutorial-Functions-Article%204"><a href="#The%20Catala%20language%20tutorial-Functions-Article%204">Article 4</a></h3>

<div class='law-text'><p>The tax amount for a two-brackets computation is equal to the amount
of income in each bracket multiplied by the rate of each bracket.</p></div>
<div class='code-wrapper catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-311">311</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-312">312</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-313">313</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-314">314</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-315">315</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-316">316</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-317">317</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-318">318</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-319">319</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-320">320</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-321">321</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-322">322</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-323">323</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-311" name="tutorial_en/tutorial_en.catala_en-311"></a><span class="kr">scope</span><span class="s"> </span><span class="nc">TwoBracketsTaxComputation</span><span class="s"> </span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-312" name="tutorial_en/tutorial_en.catala_en-312"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">tax_formula</span><span class="s"> </span><span class="kd">of</span><span class="s"> </span><span class="nv">income</span><span class="s"> </span><span class="kr">equals</span>
<a id="tutorial_en/tutorial_en.catala_en-313" name="tutorial_en/tutorial_en.catala_en-313"></a><span class="c1">    # The money parameter for the &quot;tax_formula&quot; function is introduced as</span>
<a id="tutorial_en/tutorial_en.catala_en-314" name="tutorial_en/tutorial_en.catala_en-314"></a><span class="c1">    # &quot;income&quot;. The name of the parameter is your choice, and will not impact</span>
<a id="tutorial_en/tutorial_en.catala_en-315" name="tutorial_en/tutorial_en.catala_en-315"></a><span class="c1">    # things outside this part of the definition. You can choose another</span>
<a id="tutorial_en/tutorial_en.catala_en-316" name="tutorial_en/tutorial_en.catala_en-316"></a><span class="c1">    # name in another definition of &quot;tax_formula&quot;.</span>
<a id="tutorial_en/tutorial_en.catala_en-317" name="tutorial_en/tutorial_en.catala_en-317"></a><span class="s">    </span><span class="kd">if</span><span class="s"> </span><span class="nv">income</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="nv">brackets</span><span class="o">.</span><span class="s">breakpoint </span><span class="kd">then</span>
<a id="tutorial_en/tutorial_en.catala_en-318" name="tutorial_en/tutorial_en.catala_en-318"></a><span class="s">      </span><span class="nv">income</span><span class="s"> </span><span class="o">*</span><span class="s"> </span><span class="nv">brackets</span><span class="o">.</span><span class="s">rate1</span>
<a id="tutorial_en/tutorial_en.catala_en-319" name="tutorial_en/tutorial_en.catala_en-319"></a><span class="s">    </span><span class="kd">else</span><span class="s"> </span><span class="o">(</span>
<a id="tutorial_en/tutorial_en.catala_en-320" name="tutorial_en/tutorial_en.catala_en-320"></a><span class="s">      </span><span class="nv">brackets</span><span class="o">.</span><span class="s">breakpoint </span><span class="o">*</span><span class="s"> </span><span class="nv">brackets</span><span class="o">.</span><span class="s">rate1 </span><span class="o">+</span>
<a id="tutorial_en/tutorial_en.catala_en-321" name="tutorial_en/tutorial_en.catala_en-321"></a><span class="s">      </span><span class="o">(</span><span class="nv">income</span><span class="s"> </span><span class="o">-</span><span class="s"> </span><span class="nv">brackets</span><span class="o">.</span><span class="s">breakpoint</span><span class="o">)</span><span class="s"> </span><span class="o">*</span><span class="s"> </span><span class="nv">brackets</span><span class="o">.</span><span class="s">rate2</span>
<a id="tutorial_en/tutorial_en.catala_en-322" name="tutorial_en/tutorial_en.catala_en-322"></a><span class="s">    </span><span class="o">)</span>
<a id="tutorial_en/tutorial_en.catala_en-323" name="tutorial_en/tutorial_en.catala_en-323"></a><span class="c1">    # This is the formula for implementing a two-bracketstax system.</span>
</pre></div></td></tr></table></div>

</div>


</details>
<h2 class='law-heading' id="The%20Catala%20language%20tutorial-Scope%20inclusion"><a href="#The%20Catala%20language%20tutorial-Scope%20inclusion">Scope inclusion</a></h2>
<details><summary>Scope inclusion</summary>
<div class='law-text'><p>Now that we’ve defined our helper scope for computing a two-brackets
tax, we want to use it in our main tax computation scope. As mentioned
before, Catala’s scope can also be thought of as big functions. And
these big functions can call each other, which is what we’ll see in the
below article.</p></div>
<h3 class='law-heading' id="The%20Catala%20language%20tutorial-Scope%20inclusion-Article%205"><a href="#The%20Catala%20language%20tutorial-Scope%20inclusion-Article%205">Article 5</a></h3>

<div class='law-text'><p>For individuals whose income is greater than $100,000, the income tax
of article 1 is 40% of the income above $100,000. Below $100,000, the
income tax is 20% of the income.</p></div>
<div class='code-wrapper code-metadata catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-340">340</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-341">341</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-342">342</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-343">343</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-344">344</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-345">345</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-346">346</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-340" name="tutorial_en/tutorial_en.catala_en-340"></a><span class="kr">declaration</span><span class="s"> </span><span class="kr">scope</span><span class="s"> </span><span class="nc">NewIncomeTaxComputation</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-341" name="tutorial_en/tutorial_en.catala_en-341"></a><span class="s">  </span><span class="nv">two_brackets</span><span class="s"> </span><span class="kr">scope</span><span class="s"> </span><span class="nc">TwoBracketsTaxComputation</span>
<a id="tutorial_en/tutorial_en.catala_en-342" name="tutorial_en/tutorial_en.catala_en-342"></a><span class="c1">  # This line says that we add the item two_brackets to the context.</span>
<a id="tutorial_en/tutorial_en.catala_en-343" name="tutorial_en/tutorial_en.catala_en-343"></a><span class="c1">  # However, the &quot;scope&quot; keyword tells that this item is not a piece of data</span>
<a id="tutorial_en/tutorial_en.catala_en-344" name="tutorial_en/tutorial_en.catala_en-344"></a><span class="c1">  # but rather a subscope that we can use to compute things.</span>
<a id="tutorial_en/tutorial_en.catala_en-345" name="tutorial_en/tutorial_en.catala_en-345"></a><span class="s">  </span><span class="kd">input</span><span class="s"> </span><span class="nv">individual</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="nc">Individual</span>
<a id="tutorial_en/tutorial_en.catala_en-346" name="tutorial_en/tutorial_en.catala_en-346"></a><span class="s">  </span><span class="kd">output</span><span class="s"> </span><span class="nv">income_tax</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">money</span>
</pre></div></td></tr></table></div>

</div>

<div class='code-wrapper catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-350">350</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-351">351</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-352">352</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-353">353</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-354">354</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-355">355</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-356">356</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-357">357</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-358">358</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-359">359</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-360">360</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-361">361</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-362">362</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-363">363</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-364">364</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-365">365</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-366">366</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-367">367</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-368">368</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-350" name="tutorial_en/tutorial_en.catala_en-350"></a><span class="kr">scope</span><span class="s"> </span><span class="nc">NewIncomeTaxComputation</span><span class="s"> </span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-351" name="tutorial_en/tutorial_en.catala_en-351"></a><span class="c1">  # Since the subscope &quot;two_brackets&quot; is like a big function we can call,</span>
<a id="tutorial_en/tutorial_en.catala_en-352" name="tutorial_en/tutorial_en.catala_en-352"></a><span class="c1">  # we need to define its arguments. This is done below:</span>
<a id="tutorial_en/tutorial_en.catala_en-353" name="tutorial_en/tutorial_en.catala_en-353"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">two_brackets</span><span class="o">.</span><span class="s">brackets </span><span class="kr">equals</span><span class="s"> </span><span class="nc">TwoBrackets</span><span class="s"> </span><span class="o">{</span>
<a id="tutorial_en/tutorial_en.catala_en-354" name="tutorial_en/tutorial_en.catala_en-354"></a><span class="s">    </span><span class="o">--</span><span class="s"> </span><span class="nv">breakpoint</span><span class="o">:</span><span class="s"> </span><span class="o">$</span><span class="mi">100,000</span>
<a id="tutorial_en/tutorial_en.catala_en-355" name="tutorial_en/tutorial_en.catala_en-355"></a><span class="s">    </span><span class="o">--</span><span class="s"> </span><span class="nv">rate1</span><span class="o">:</span><span class="s"> </span><span class="mi">20</span><span class="o">%</span>
<a id="tutorial_en/tutorial_en.catala_en-356" name="tutorial_en/tutorial_en.catala_en-356"></a><span class="s">    </span><span class="o">--</span><span class="s"> </span><span class="nv">rate2</span><span class="o">:</span><span class="s"> </span><span class="mi">40</span><span class="o">%</span>
<a id="tutorial_en/tutorial_en.catala_en-357" name="tutorial_en/tutorial_en.catala_en-357"></a><span class="s">  </span><span class="o">}</span>
<a id="tutorial_en/tutorial_en.catala_en-358" name="tutorial_en/tutorial_en.catala_en-358"></a><span class="c1">  # By defining the input variable &quot;brackets&quot; of the subscope &quot;two_brackets&quot;,</span>
<a id="tutorial_en/tutorial_en.catala_en-359" name="tutorial_en/tutorial_en.catala_en-359"></a><span class="c1">  # we have changed how the subscope will execute. The subscope will execute</span>
<a id="tutorial_en/tutorial_en.catala_en-360" name="tutorial_en/tutorial_en.catala_en-360"></a><span class="c1">  # with all the values defined by the caller, then compute the value</span>
<a id="tutorial_en/tutorial_en.catala_en-361" name="tutorial_en/tutorial_en.catala_en-361"></a><span class="c1">  # of its other variables.</span>
<a id="tutorial_en/tutorial_en.catala_en-362" name="tutorial_en/tutorial_en.catala_en-362"></a>
<a id="tutorial_en/tutorial_en.catala_en-363" name="tutorial_en/tutorial_en.catala_en-363"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">income_tax</span><span class="s"> </span><span class="kr">equals</span><span class="s"> </span><span class="nv">two_brackets</span><span class="o">.</span><span class="s">tax_formula </span><span class="kd">of</span><span class="s"> </span><span class="nv">individual</span><span class="o">.</span><span class="s">income</span>
<a id="tutorial_en/tutorial_en.catala_en-364" name="tutorial_en/tutorial_en.catala_en-364"></a><span class="c1">  # After the subscope has executed, you can retrieve results from it. Here,</span>
<a id="tutorial_en/tutorial_en.catala_en-365" name="tutorial_en/tutorial_en.catala_en-365"></a><span class="c1">  # we retrive the result of variable &quot;tax_formula&quot; of computed by the</span>
<a id="tutorial_en/tutorial_en.catala_en-366" name="tutorial_en/tutorial_en.catala_en-366"></a><span class="c1">  # subscope &quot;two_brackets&quot;. It&#39;s up yo you to choose what is an input and</span>
<a id="tutorial_en/tutorial_en.catala_en-367" name="tutorial_en/tutorial_en.catala_en-367"></a><span class="c1">  # an output of your subscope; if you make an inconsistent choice, the</span>
<a id="tutorial_en/tutorial_en.catala_en-368" name="tutorial_en/tutorial_en.catala_en-368"></a><span class="c1">  # Catala compiler will warn you.</span>
</pre></div></td></tr></table></div>

</div>
<div class='law-text'><p>Now that we’ve successfully defined our income tax computation, the
legislator inevitably comes to disturb our beautiful and regular
formulas to add a special case! The article below is a really common
pattern in statutes, and let’s see how Catala handles it.</p></div>

<h3 class='law-heading' id="The%20Catala%20language%20tutorial-Scope%20inclusion-Article%206"><a href="#The%20Catala%20language%20tutorial-Scope%20inclusion-Article%206">Article 6</a></h3>

<div class='law-text'><p>Individuals earning less than $10,000 are exempted of the income tax
mentioned at article 1.</p></div>
<div class='code-wrapper catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-382">382</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-383">383</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-384">384</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-385">385</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-386">386</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-387">387</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-388">388</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-389">389</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-382" name="tutorial_en/tutorial_en.catala_en-382"></a><span class="kr">scope</span><span class="s"> </span><span class="nc">NewIncomeTaxComputation</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-383" name="tutorial_en/tutorial_en.catala_en-383"></a><span class="c1">  # Here, we simply define a new conditional definition for &quot;income tax&quot;</span>
<a id="tutorial_en/tutorial_en.catala_en-384" name="tutorial_en/tutorial_en.catala_en-384"></a><span class="c1">  # that handles the special case.</span>
<a id="tutorial_en/tutorial_en.catala_en-385" name="tutorial_en/tutorial_en.catala_en-385"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">income_tax</span><span class="s"> </span><span class="kr">under condition</span>
<a id="tutorial_en/tutorial_en.catala_en-386" name="tutorial_en/tutorial_en.catala_en-386"></a><span class="s">    </span><span class="nv">individual</span><span class="o">.</span><span class="s">income </span><span class="o">&lt;=</span><span class="s"> </span><span class="o">$</span><span class="mi">10,000</span>
<a id="tutorial_en/tutorial_en.catala_en-387" name="tutorial_en/tutorial_en.catala_en-387"></a><span class="s">  </span><span class="kr">consequence</span><span class="s"> </span><span class="kr">equals</span><span class="s"> </span><span class="o">$</span><span class="mi">0</span>
<a id="tutorial_en/tutorial_en.catala_en-388" name="tutorial_en/tutorial_en.catala_en-388"></a><span class="c1">  # What, you think something might be wrong with this? Hmmm... We&#39;ll see</span>
<a id="tutorial_en/tutorial_en.catala_en-389" name="tutorial_en/tutorial_en.catala_en-389"></a><span class="c1">  # later!</span>
</pre></div></td></tr></table></div>

</div>
<div class='law-text'><p>That’s it! We’ve defined a two-brackets tax computation with a
special case simply by annotating legislative article by snippets of
Catala code. However, attentive readers may have caught something weird
in the Catala translation of articles 5 and 6. What happens when the
income of the individual is lesser than $10,000? Right now, the two
definitions at articles 5 and 6 for income_tax apply, and they’re in
conflict.</p>
<p>This is a flaw in the Catala translation, but the language can help
you find this sort of errors via simple testing or even formal
verification. Let’s start with the testing.</p></div>

</details>
<h2 class='law-heading' id="The%20Catala%20language%20tutorial-Testing%20Catala%20programs"><a href="#The%20Catala%20language%20tutorial-Testing%20Catala%20programs">Testing Catala programs</a></h2>
<details><summary>Testing Catala programs</summary>
<div class='law-text'><p>Testing Catala programs can be done directly into Catala. Indeed,
writing test cases for each Catala scope that you define is a good
practice called “unit testing” in the software engineering community. A
test case is defined as another scope:</p></div>
<h3 class='law-heading' id="The%20Catala%20language%20tutorial-Testing%20Catala%20programs-Testing%20NewIncomeTaxComputation"><a href="#The%20Catala%20language%20tutorial-Testing%20Catala%20programs-Testing%20NewIncomeTaxComputation">Testing NewIncomeTaxComputation</a></h3>


<div class='code-wrapper catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-413">413</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-414">414</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-415">415</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-416">416</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-417">417</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-418">418</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-419">419</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-420">420</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-421">421</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-422">422</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-423">423</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-424">424</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-425">425</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-426">426</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-427">427</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-428">428</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-429">429</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-430">430</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-431">431</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-432">432</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-433">433</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-434">434</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-435">435</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-436">436</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-437">437</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-438">438</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-413" name="tutorial_en/tutorial_en.catala_en-413"></a><span class="kr">declaration</span><span class="s"> </span><span class="kr">scope</span><span class="s"> </span><span class="nc">Test1</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-414" name="tutorial_en/tutorial_en.catala_en-414"></a><span class="c1">  # We include the scope to tax as a subscope.</span>
<a id="tutorial_en/tutorial_en.catala_en-415" name="tutorial_en/tutorial_en.catala_en-415"></a><span class="s">  </span><span class="nv">tax_computation</span><span class="s"> </span><span class="kr">scope</span><span class="s"> </span><span class="nc">NewIncomeTaxComputation</span>
<a id="tutorial_en/tutorial_en.catala_en-416" name="tutorial_en/tutorial_en.catala_en-416"></a><span class="s">  </span><span class="kd">output</span><span class="s"> </span><span class="nv">income_tax</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">money</span>
<a id="tutorial_en/tutorial_en.catala_en-417" name="tutorial_en/tutorial_en.catala_en-417"></a>
<a id="tutorial_en/tutorial_en.catala_en-418" name="tutorial_en/tutorial_en.catala_en-418"></a><span class="c1"># To execute that test, assuming that the Catala compiler can be called</span>
<a id="tutorial_en/tutorial_en.catala_en-419" name="tutorial_en/tutorial_en.catala_en-419"></a><span class="c1"># with &quot;catala&quot;, you can enter the following command:</span>
<a id="tutorial_en/tutorial_en.catala_en-420" name="tutorial_en/tutorial_en.catala_en-420"></a><span class="c1">#     catala Interpret --scope=Test1 tutorial_en.catala_en</span>
<a id="tutorial_en/tutorial_en.catala_en-421" name="tutorial_en/tutorial_en.catala_en-421"></a>
<a id="tutorial_en/tutorial_en.catala_en-422" name="tutorial_en/tutorial_en.catala_en-422"></a><span class="kr">scope</span><span class="s"> </span><span class="nc">Test1</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-423" name="tutorial_en/tutorial_en.catala_en-423"></a><span class="s">  </span><span class="kr">definition</span>
<a id="tutorial_en/tutorial_en.catala_en-424" name="tutorial_en/tutorial_en.catala_en-424"></a><span class="s">    </span><span class="nv">tax_computation</span><span class="o">.</span><span class="s">individual</span>
<a id="tutorial_en/tutorial_en.catala_en-425" name="tutorial_en/tutorial_en.catala_en-425"></a><span class="c1">    # We define the argument to the subscope</span>
<a id="tutorial_en/tutorial_en.catala_en-426" name="tutorial_en/tutorial_en.catala_en-426"></a><span class="s">  </span><span class="kr">equals</span>
<a id="tutorial_en/tutorial_en.catala_en-427" name="tutorial_en/tutorial_en.catala_en-427"></a><span class="c1">    # The four lines below define a whole structure by giving a value to</span>
<a id="tutorial_en/tutorial_en.catala_en-428" name="tutorial_en/tutorial_en.catala_en-428"></a><span class="c1">    # each of its fields</span>
<a id="tutorial_en/tutorial_en.catala_en-429" name="tutorial_en/tutorial_en.catala_en-429"></a><span class="s">    </span><span class="nc">Individual</span><span class="s"> </span><span class="o">{</span>
<a id="tutorial_en/tutorial_en.catala_en-430" name="tutorial_en/tutorial_en.catala_en-430"></a><span class="s">      </span><span class="o">--</span><span class="s"> </span><span class="nv">income</span><span class="o">:</span><span class="s"> </span><span class="o">$</span><span class="mi">230,000</span>
<a id="tutorial_en/tutorial_en.catala_en-431" name="tutorial_en/tutorial_en.catala_en-431"></a><span class="s">      </span><span class="o">--</span><span class="s"> </span><span class="nv">number_of_children</span><span class="o">:</span><span class="s"> </span><span class="mi">0</span>
<a id="tutorial_en/tutorial_en.catala_en-432" name="tutorial_en/tutorial_en.catala_en-432"></a><span class="s">    </span><span class="o">}</span>
<a id="tutorial_en/tutorial_en.catala_en-433" name="tutorial_en/tutorial_en.catala_en-433"></a>
<a id="tutorial_en/tutorial_en.catala_en-434" name="tutorial_en/tutorial_en.catala_en-434"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">income_tax</span><span class="s"> </span><span class="kr">equals</span><span class="s"> </span><span class="nv">tax_computation</span><span class="o">.</span><span class="s">income_tax</span>
<a id="tutorial_en/tutorial_en.catala_en-435" name="tutorial_en/tutorial_en.catala_en-435"></a><span class="c1">  # Next, we retrieve the income tax value compute it by the subscope and</span>
<a id="tutorial_en/tutorial_en.catala_en-436" name="tutorial_en/tutorial_en.catala_en-436"></a><span class="c1">  # assert that it is equal to the expected value :</span>
<a id="tutorial_en/tutorial_en.catala_en-437" name="tutorial_en/tutorial_en.catala_en-437"></a><span class="c1">  # ($230,000-100,000)*40%+100,000*20% = $72,000</span>
<a id="tutorial_en/tutorial_en.catala_en-438" name="tutorial_en/tutorial_en.catala_en-438"></a><span class="s">  </span><span class="kr">assertion</span><span class="s"> </span><span class="nv">income_tax</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="o">$</span><span class="mi">72,000</span>
</pre></div></td></tr></table></div>

</div>
<div class='law-text'><p>This test should pass. We can validate it by inserting a special test
snippet in the file as follows:</p>
<pre class="catala-test-inline"><code>$ catala interpret --scope Test1 --disable-warnings
┌─[RESULT]─
│ income_tax = $72,000.00
└─</code></pre>
<p>Running <code>clerk test</code> will automatically check that the
given command matches its expected output when run on this file (in
practice, it’s generally preferred to put such tests in a separate
file).</p>
<p>Let us now consider a failing test case:</p></div>
<div class='code-wrapper catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-458">458</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-459">459</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-460">460</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-461">461</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-462">462</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-463">463</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-464">464</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-465">465</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-466">466</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-467">467</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-468">468</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-469">469</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-458" name="tutorial_en/tutorial_en.catala_en-458"></a><span class="kr">declaration</span><span class="s"> </span><span class="kr">scope</span><span class="s"> </span><span class="nc">Test2</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-459" name="tutorial_en/tutorial_en.catala_en-459"></a><span class="s">  </span><span class="nv">tax_computation</span><span class="s"> </span><span class="kr">scope</span><span class="s"> </span><span class="nc">NewIncomeTaxComputation</span>
<a id="tutorial_en/tutorial_en.catala_en-460" name="tutorial_en/tutorial_en.catala_en-460"></a><span class="s">  </span><span class="kd">output</span><span class="s"> </span><span class="nv">income_tax</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">money</span>
<a id="tutorial_en/tutorial_en.catala_en-461" name="tutorial_en/tutorial_en.catala_en-461"></a>
<a id="tutorial_en/tutorial_en.catala_en-462" name="tutorial_en/tutorial_en.catala_en-462"></a><span class="kr">scope</span><span class="s"> </span><span class="nc">Test2</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-463" name="tutorial_en/tutorial_en.catala_en-463"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">tax_computation</span><span class="o">.</span><span class="s">individual </span><span class="kr">equals</span><span class="s"> </span><span class="nc">Individual</span><span class="s"> </span><span class="o">{</span>
<a id="tutorial_en/tutorial_en.catala_en-464" name="tutorial_en/tutorial_en.catala_en-464"></a><span class="s">    </span><span class="o">--</span><span class="s"> </span><span class="nv">income</span><span class="o">:</span><span class="s"> </span><span class="o">$</span><span class="mi">4,000</span>
<a id="tutorial_en/tutorial_en.catala_en-465" name="tutorial_en/tutorial_en.catala_en-465"></a><span class="s">    </span><span class="o">--</span><span class="s"> </span><span class="nv">number_of_children</span><span class="o">:</span><span class="s"> </span><span class="mi">0</span>
<a id="tutorial_en/tutorial_en.catala_en-466" name="tutorial_en/tutorial_en.catala_en-466"></a><span class="s">  </span><span class="o">}</span>
<a id="tutorial_en/tutorial_en.catala_en-467" name="tutorial_en/tutorial_en.catala_en-467"></a>
<a id="tutorial_en/tutorial_en.catala_en-468" name="tutorial_en/tutorial_en.catala_en-468"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">income_tax</span><span class="s"> </span><span class="kr">equals</span><span class="s"> </span><span class="nv">tax_computation</span><span class="o">.</span><span class="s">income_tax</span>
<a id="tutorial_en/tutorial_en.catala_en-469" name="tutorial_en/tutorial_en.catala_en-469"></a><span class="s">  </span><span class="kr">assertion</span><span class="s"> </span><span class="nv">income_tax</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="o">$</span><span class="mi">0</span>
</pre></div></td></tr></table></div>

</div>
<div class='law-text'><pre class="catala-test-inline"><code>$ catala interpret --scope Test2 --disable-warnings
┌─[ERROR]─
│
│  During evaluation: conflict between multiple valid consequences for
│  assigning the same variable.
│
├─➤ tutorial_en/tutorial_en.catala_en:318.7-318.30:
│     │
│ 318 │       income * brackets.rate1
│     │       ‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾
├─ The Catala language tutorial
│  └┬ Functions
│   └─ Article 4
│
├─➤ tutorial_en/tutorial_en.catala_en:387.22-387.24:
│     │
│ 387 │   consequence equals $0
│     │                      ‾‾
└─ The Catala language tutorial
   └┬ Scope inclusion
    └─ Article 6
#return code 123#</code></pre>
<p>This test case should compute a $0 income tax because of Article 6.
But instead, execution yields an error stating that there is a conflict
between rules.</p></div>

</details>
<h2 class='law-heading' id="The%20Catala%20language%20tutorial-Defining%20exceptions%20to%20rules"><a href="#The%20Catala%20language%20tutorial-Defining%20exceptions%20to%20rules">Defining exceptions to rules</a></h2>
<details><summary>Defining exceptions to rules</summary>
<div class='law-text'><p>Indeed, the definition of the income tax in article 6 conflicts with
the definition of income tax in article 5. But actually, article 6 is
just an exception of article 5. In the law, it is implicit that if
article 6 is applicable, then it takes precedence over article 5.</p></div>
<h3 class='law-heading' id="The%20Catala%20language%20tutorial-Defining%20exceptions%20to%20rules-Fixing%20the%20computation"><a href="#The%20Catala%20language%20tutorial-Defining%20exceptions%20to%20rules-Fixing%20the%20computation">Fixing the computation</a></h3>

<div class='law-text'><p>This implicit precedence has to be explicitly declared in Catala.
Here is a fixed version of the NewIncomeTaxComputation scope:</p></div>
<div class='code-wrapper code-metadata catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-513">513</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-514">514</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-515">515</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-516">516</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-517">517</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-518">518</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-519">519</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-520">520</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-513" name="tutorial_en/tutorial_en.catala_en-513"></a><span class="kr">declaration</span><span class="s"> </span><span class="kr">scope</span><span class="s"> </span><span class="nc">NewIncomeTaxComputationFixed</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-514" name="tutorial_en/tutorial_en.catala_en-514"></a><span class="s">  </span><span class="nv">two_brackets</span><span class="s"> </span><span class="kr">scope</span><span class="s"> </span><span class="nc">TwoBracketsTaxComputation</span>
<a id="tutorial_en/tutorial_en.catala_en-515" name="tutorial_en/tutorial_en.catala_en-515"></a><span class="s">  </span><span class="kd">input</span><span class="s"> </span><span class="nv">individual</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="nc">Individual</span>
<a id="tutorial_en/tutorial_en.catala_en-516" name="tutorial_en/tutorial_en.catala_en-516"></a><span class="s">  </span><span class="kd">output</span><span class="s"> </span><span class="nv">tax_formula</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">money</span><span class="s"> </span><span class="kr">depends on</span><span class="s"> </span><span class="nv">income</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">money</span>
<a id="tutorial_en/tutorial_en.catala_en-517" name="tutorial_en/tutorial_en.catala_en-517"></a><span class="s">  </span><span class="kd">context</span><span class="s"> </span><span class="kd">output</span><span class="s"> </span><span class="nv">income_tax</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">money</span>
<a id="tutorial_en/tutorial_en.catala_en-518" name="tutorial_en/tutorial_en.catala_en-518"></a><span class="c1">  # This variable is tagged with &quot;context&quot;, a new concept which we have not</span>
<a id="tutorial_en/tutorial_en.catala_en-519" name="tutorial_en/tutorial_en.catala_en-519"></a><span class="c1">  # introduced yet. For now, ignore it as we&#39;ll come back to it in the section</span>
<a id="tutorial_en/tutorial_en.catala_en-520" name="tutorial_en/tutorial_en.catala_en-520"></a><span class="c1">  # &quot;Context scope variables&quot;.</span>
</pre></div></td></tr></table></div>

</div>

<div class='code-wrapper catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-524">524</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-525">525</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-526">526</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-527">527</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-528">528</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-529">529</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-530">530</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-524" name="tutorial_en/tutorial_en.catala_en-524"></a><span class="kr">scope</span><span class="s"> </span><span class="nc">NewIncomeTaxComputationFixed</span><span class="s"> </span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-525" name="tutorial_en/tutorial_en.catala_en-525"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">two_brackets</span><span class="o">.</span><span class="s">brackets </span><span class="kr">equals</span><span class="s"> </span><span class="nc">TwoBrackets</span><span class="s"> </span><span class="o">{</span>
<a id="tutorial_en/tutorial_en.catala_en-526" name="tutorial_en/tutorial_en.catala_en-526"></a><span class="s">    </span><span class="o">--</span><span class="s"> </span><span class="nv">breakpoint</span><span class="o">:</span><span class="s"> </span><span class="o">$</span><span class="mi">100,000</span>
<a id="tutorial_en/tutorial_en.catala_en-527" name="tutorial_en/tutorial_en.catala_en-527"></a><span class="s">    </span><span class="o">--</span><span class="s"> </span><span class="nv">rate1</span><span class="o">:</span><span class="s"> </span><span class="mi">20</span><span class="o">%</span>
<a id="tutorial_en/tutorial_en.catala_en-528" name="tutorial_en/tutorial_en.catala_en-528"></a><span class="s">    </span><span class="o">--</span><span class="s"> </span><span class="nv">rate2</span><span class="o">:</span><span class="s"> </span><span class="mi">40</span><span class="o">%</span>
<a id="tutorial_en/tutorial_en.catala_en-529" name="tutorial_en/tutorial_en.catala_en-529"></a><span class="s">  </span><span class="o">}</span>
<a id="tutorial_en/tutorial_en.catala_en-530" name="tutorial_en/tutorial_en.catala_en-530"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">tax_formula</span><span class="s"> </span><span class="kd">of</span><span class="s"> </span><span class="nv">income</span><span class="s"> </span><span class="kr">equals</span><span class="s"> </span><span class="nv">two_brackets</span><span class="o">.</span><span class="s">tax_formula </span><span class="kd">of</span><span class="s"> </span><span class="nv">income</span>
</pre></div></td></tr></table></div>

</div>
<div class='law-text'><p>To define an exception to a rule, you have to first label the rule
that you want to attach the exception to. You can put any snake_case
identifier for the label:</p></div>
<div class='code-wrapper catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-538">538</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-539">539</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-540">540</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-541">541</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-542">542</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-543">543</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-544">544</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-545">545</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-546">546</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-538" name="tutorial_en/tutorial_en.catala_en-538"></a><span class="kr">scope</span><span class="s"> </span><span class="nc">NewIncomeTaxComputationFixed</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-539" name="tutorial_en/tutorial_en.catala_en-539"></a><span class="s">  </span><span class="kr">label</span><span class="s"> </span><span class="nv">article_5</span>
<a id="tutorial_en/tutorial_en.catala_en-540" name="tutorial_en/tutorial_en.catala_en-540"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">income_tax</span><span class="s"> </span><span class="kr">equals</span><span class="s"> </span><span class="nv">two_brackets</span><span class="o">.</span><span class="s">tax_formula </span><span class="kd">of</span><span class="s"> </span><span class="nv">individual</span><span class="o">.</span><span class="s">income</span>
<a id="tutorial_en/tutorial_en.catala_en-541" name="tutorial_en/tutorial_en.catala_en-541"></a>
<a id="tutorial_en/tutorial_en.catala_en-542" name="tutorial_en/tutorial_en.catala_en-542"></a><span class="c1">  # Then, you can declare the exception by referring back to the label</span>
<a id="tutorial_en/tutorial_en.catala_en-543" name="tutorial_en/tutorial_en.catala_en-543"></a><span class="s">  </span><span class="kr">exception</span><span class="s"> </span><span class="nv">article_5</span>
<a id="tutorial_en/tutorial_en.catala_en-544" name="tutorial_en/tutorial_en.catala_en-544"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">income_tax</span><span class="s"> </span><span class="kr">under condition</span>
<a id="tutorial_en/tutorial_en.catala_en-545" name="tutorial_en/tutorial_en.catala_en-545"></a><span class="s">    </span><span class="nv">individual</span><span class="o">.</span><span class="s">income </span><span class="o">&lt;=</span><span class="s"> </span><span class="o">$</span><span class="mi">10,000</span>
<a id="tutorial_en/tutorial_en.catala_en-546" name="tutorial_en/tutorial_en.catala_en-546"></a><span class="s">  </span><span class="kr">consequence</span><span class="s"> </span><span class="kr">equals</span><span class="s"> </span><span class="o">$</span><span class="mi">0</span>
</pre></div></td></tr></table></div>

</div>
<div class='law-text'><p>And the test that should now work:</p></div>
<div class='code-wrapper catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-552">552</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-553">553</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-554">554</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-555">555</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-556">556</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-557">557</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-558">558</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-559">559</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-560">560</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-561">561</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-562">562</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-552" name="tutorial_en/tutorial_en.catala_en-552"></a><span class="kr">declaration</span><span class="s"> </span><span class="kr">scope</span><span class="s"> </span><span class="nc">Test3</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-553" name="tutorial_en/tutorial_en.catala_en-553"></a><span class="s">  </span><span class="nv">tax_computation</span><span class="s"> </span><span class="kr">scope</span><span class="s"> </span><span class="nc">NewIncomeTaxComputationFixed</span>
<a id="tutorial_en/tutorial_en.catala_en-554" name="tutorial_en/tutorial_en.catala_en-554"></a><span class="s">  </span><span class="kd">output</span><span class="s"> </span><span class="nv">income_tax</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">money</span>
<a id="tutorial_en/tutorial_en.catala_en-555" name="tutorial_en/tutorial_en.catala_en-555"></a>
<a id="tutorial_en/tutorial_en.catala_en-556" name="tutorial_en/tutorial_en.catala_en-556"></a><span class="kr">scope</span><span class="s"> </span><span class="nc">Test3</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-557" name="tutorial_en/tutorial_en.catala_en-557"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">tax_computation</span><span class="o">.</span><span class="s">individual </span><span class="kr">equals</span><span class="s"> </span><span class="nc">Individual</span><span class="s"> </span><span class="o">{</span>
<a id="tutorial_en/tutorial_en.catala_en-558" name="tutorial_en/tutorial_en.catala_en-558"></a><span class="s">    </span><span class="o">--</span><span class="s"> </span><span class="nv">income</span><span class="o">:</span><span class="s"> </span><span class="o">$</span><span class="mi">4,000</span>
<a id="tutorial_en/tutorial_en.catala_en-559" name="tutorial_en/tutorial_en.catala_en-559"></a><span class="s">    </span><span class="o">--</span><span class="s"> </span><span class="nv">number_of_children</span><span class="o">:</span><span class="s"> </span><span class="mi">0</span>
<a id="tutorial_en/tutorial_en.catala_en-560" name="tutorial_en/tutorial_en.catala_en-560"></a><span class="s">  </span><span class="o">}</span>
<a id="tutorial_en/tutorial_en.catala_en-561" name="tutorial_en/tutorial_en.catala_en-561"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">income_tax</span><span class="s"> </span><span class="kr">equals</span><span class="s"> </span><span class="nv">tax_computation</span><span class="o">.</span><span class="s">income_tax</span>
<a id="tutorial_en/tutorial_en.catala_en-562" name="tutorial_en/tutorial_en.catala_en-562"></a><span class="s">  </span><span class="kr">assertion</span><span class="s"> </span><span class="nv">income_tax</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="o">$</span><span class="mi">0</span>
</pre></div></td></tr></table></div>

</div>
<div class='law-text'><pre class="catala-test-inline"><code>$ catala interpret --scope Test3 --disable-warnings
┌─[RESULT]─
│ income_tax = $0.00
└─</code></pre></div>

<h3 class='law-heading' id="The%20Catala%20language%20tutorial-Defining%20exceptions%20to%20rules-Defining%20exceptions%20to%20groups%20of%20rules"><a href="#The%20Catala%20language%20tutorial-Defining%20exceptions%20to%20rules-Defining%20exceptions%20to%20groups%20of%20rules">Defining exceptions to groups of rules</a></h3>

<div class='law-text'><p>Note that the label system also lets you define more complicated
exceptions patterns. Sometimes, you want to declare an exception to a
group of piecewise definitions. To do that, simply use the same label
for all the piecewise definitions.</p></div>

<h3 class='law-heading' id="The%20Catala%20language%20tutorial-Defining%20exceptions%20to%20rules-Cumulative%20exceptions"><a href="#The%20Catala%20language%20tutorial-Defining%20exceptions%20to%20rules-Cumulative%20exceptions">Cumulative exceptions</a></h3>

<div class='law-text'><p>As we have seen, two exceptions applying at the same time to a given
rule are in conflict, and trigger an error. It happens, though, that
these exceptions yield the same end result: for convenience, Catala
tolerates this case and returns the common result, as long as there is a
strict syntactic equality.</p></div>
<h4 class='law-heading' id="The%20Catala%20language%20tutorial-Defining%20exceptions%20to%20rules-Cumulative%20exceptions-Article%206%20bis"><a href="#The%20Catala%20language%20tutorial-Defining%20exceptions%20to%20rules-Cumulative%20exceptions-Article%206%20bis">Article 6 bis</a></h4>

<div class='law-text'><p>Individuals with 7 children or more are exempted of the income tax
mentioned at article 1.</p></div>
<div class='code-wrapper catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-592">592</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-593">593</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-594">594</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-595">595</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-596">596</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-592" name="tutorial_en/tutorial_en.catala_en-592"></a><span class="kr">scope</span><span class="s"> </span><span class="nc">NewIncomeTaxComputationFixed</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-593" name="tutorial_en/tutorial_en.catala_en-593"></a><span class="s">  </span><span class="kr">exception</span><span class="s"> </span><span class="nv">article_5</span>
<a id="tutorial_en/tutorial_en.catala_en-594" name="tutorial_en/tutorial_en.catala_en-594"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">income_tax</span><span class="s"> </span><span class="kr">under condition</span>
<a id="tutorial_en/tutorial_en.catala_en-595" name="tutorial_en/tutorial_en.catala_en-595"></a><span class="s">    </span><span class="nv">individual</span><span class="o">.</span><span class="s">number_of_children </span><span class="o">&gt;=</span><span class="s"> </span><span class="mi">7</span>
<a id="tutorial_en/tutorial_en.catala_en-596" name="tutorial_en/tutorial_en.catala_en-596"></a><span class="s">  </span><span class="kr">consequence</span><span class="s"> </span><span class="kr">equals</span><span class="s"> </span><span class="o">$</span><span class="mi">0</span>
</pre></div></td></tr></table></div>

</div>
<div class='law-text'><p>The same problem as above would be triggered for families with an
income below <code>$10,000</code> and 7 children or more. But here
Catala can detect that it won’t matter since the result in both cases is
an exemption.</p></div>
<div class='code-wrapper catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-604">604</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-605">605</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-606">606</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-607">607</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-608">608</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-609">609</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-610">610</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-611">611</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-612">612</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-613">613</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-614">614</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-604" name="tutorial_en/tutorial_en.catala_en-604"></a><span class="kr">declaration</span><span class="s"> </span><span class="kr">scope</span><span class="s"> </span><span class="nc">Test4</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-605" name="tutorial_en/tutorial_en.catala_en-605"></a><span class="s">  </span><span class="nv">tax_computation</span><span class="s"> </span><span class="kr">scope</span><span class="s"> </span><span class="nc">NewIncomeTaxComputationFixed</span>
<a id="tutorial_en/tutorial_en.catala_en-606" name="tutorial_en/tutorial_en.catala_en-606"></a><span class="s">  </span><span class="kd">output</span><span class="s"> </span><span class="nv">income_tax</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">money</span>
<a id="tutorial_en/tutorial_en.catala_en-607" name="tutorial_en/tutorial_en.catala_en-607"></a>
<a id="tutorial_en/tutorial_en.catala_en-608" name="tutorial_en/tutorial_en.catala_en-608"></a><span class="kr">scope</span><span class="s"> </span><span class="nc">Test4</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-609" name="tutorial_en/tutorial_en.catala_en-609"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">tax_computation</span><span class="o">.</span><span class="s">individual </span><span class="kr">equals</span><span class="s"> </span><span class="nc">Individual</span><span class="s"> </span><span class="o">{</span>
<a id="tutorial_en/tutorial_en.catala_en-610" name="tutorial_en/tutorial_en.catala_en-610"></a><span class="s">    </span><span class="o">--</span><span class="s"> </span><span class="nv">income</span><span class="o">:</span><span class="s"> </span><span class="o">$</span><span class="mi">7,000</span>
<a id="tutorial_en/tutorial_en.catala_en-611" name="tutorial_en/tutorial_en.catala_en-611"></a><span class="s">    </span><span class="o">--</span><span class="s"> </span><span class="nv">number_of_children</span><span class="o">:</span><span class="s"> </span><span class="mi">7</span>
<a id="tutorial_en/tutorial_en.catala_en-612" name="tutorial_en/tutorial_en.catala_en-612"></a><span class="s">  </span><span class="o">}</span>
<a id="tutorial_en/tutorial_en.catala_en-613" name="tutorial_en/tutorial_en.catala_en-613"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">income_tax</span><span class="s"> </span><span class="kr">equals</span><span class="s"> </span><span class="nv">tax_computation</span><span class="o">.</span><span class="s">income_tax</span>
<a id="tutorial_en/tutorial_en.catala_en-614" name="tutorial_en/tutorial_en.catala_en-614"></a><span class="s">  </span><span class="kr">assertion</span><span class="s"> </span><span class="nv">income_tax</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="o">$</span><span class="mi">0</span>
</pre></div></td></tr></table></div>

</div>
<div class='law-text'><pre class="catala-test-inline"><code>$ catala interpret --scope Test4 --disable-warnings
┌─[RESULT]─
│ income_tax = $0.00
└─</code></pre></div>


<h3 class='law-heading' id="The%20Catala%20language%20tutorial-Defining%20exceptions%20to%20rules-Direct%20scope%20calls"><a href="#The%20Catala%20language%20tutorial-Defining%20exceptions%20to%20rules-Direct%20scope%20calls">Direct scope calls</a></h3>

<div class='law-text'><p>In some cases, it is useful to apply the computation of a scope only
under specific circumstances. For example, some social benefits may have
different computation modes depending on the situation of the
beneficiary. In this case, defining each of the different modes as
subscopes can be tedious for two reasons: first, some input values may
not be relevant for the cases the beneficiary is not concerned with, and
the language will still enforce that you leave nothing undefined ;
second, unnecessary computation will take place.</p>
<p>For these cases, it is possible to call a scope directly, specifying
all its input variables at once, and getting back its output variables
in a way similar to usual subscopes.</p></div>
<div class='code-wrapper catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-639">639</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-640">640</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-641">641</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-642">642</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-643">643</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-644">644</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-645">645</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-646">646</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-647">647</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-648">648</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-649">649</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-650">650</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-651">651</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-652">652</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-653">653</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-654">654</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-655">655</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-656">656</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-657">657</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-658">658</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-639" name="tutorial_en/tutorial_en.catala_en-639"></a><span class="kr">declaration</span><span class="s"> </span><span class="kr">scope</span><span class="s"> </span><span class="nc">Test5</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-640" name="tutorial_en/tutorial_en.catala_en-640"></a><span class="s">  </span><span class="kd">internal</span><span class="s"> </span><span class="nv">individual</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="nc">Individual</span>
<a id="tutorial_en/tutorial_en.catala_en-641" name="tutorial_en/tutorial_en.catala_en-641"></a><span class="s">  </span><span class="kd">internal</span><span class="s"> </span><span class="nv">normal_income_tax_computation_applies</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">boolean</span>
<a id="tutorial_en/tutorial_en.catala_en-642" name="tutorial_en/tutorial_en.catala_en-642"></a><span class="s">  </span><span class="kd">output</span><span class="s"> </span><span class="nv">income_tax</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">money</span>
<a id="tutorial_en/tutorial_en.catala_en-643" name="tutorial_en/tutorial_en.catala_en-643"></a>
<a id="tutorial_en/tutorial_en.catala_en-644" name="tutorial_en/tutorial_en.catala_en-644"></a><span class="kr">scope</span><span class="s"> </span><span class="nc">Test5</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-645" name="tutorial_en/tutorial_en.catala_en-645"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">normal_income_tax_computation_applies</span><span class="s"> </span><span class="kr">equals</span><span class="s"> </span><span class="kc">true</span>
<a id="tutorial_en/tutorial_en.catala_en-646" name="tutorial_en/tutorial_en.catala_en-646"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">individual</span><span class="s"> </span><span class="kr">equals</span><span class="s"> </span><span class="nc">Individual</span><span class="s"> </span><span class="o">{</span>
<a id="tutorial_en/tutorial_en.catala_en-647" name="tutorial_en/tutorial_en.catala_en-647"></a><span class="s">    </span><span class="o">--</span><span class="s"> </span><span class="nv">income</span><span class="o">:</span><span class="s"> </span><span class="o">$</span><span class="mi">7,000</span>
<a id="tutorial_en/tutorial_en.catala_en-648" name="tutorial_en/tutorial_en.catala_en-648"></a><span class="s">    </span><span class="o">--</span><span class="s"> </span><span class="nv">number_of_children</span><span class="o">:</span><span class="s"> </span><span class="mi">7</span>
<a id="tutorial_en/tutorial_en.catala_en-649" name="tutorial_en/tutorial_en.catala_en-649"></a><span class="s">  </span><span class="o">}</span>
<a id="tutorial_en/tutorial_en.catala_en-650" name="tutorial_en/tutorial_en.catala_en-650"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">income_tax</span><span class="s"> </span><span class="kr">equals</span>
<a id="tutorial_en/tutorial_en.catala_en-651" name="tutorial_en/tutorial_en.catala_en-651"></a><span class="s">    </span><span class="kd">if</span><span class="s"> </span><span class="nv">normal_income_tax_computation_applies</span><span class="s"> </span><span class="kd">then</span>
<a id="tutorial_en/tutorial_en.catala_en-652" name="tutorial_en/tutorial_en.catala_en-652"></a><span class="s">      </span><span class="kr">let</span><span class="s"> </span><span class="nv">result_of_tax_computation</span>
<a id="tutorial_en/tutorial_en.catala_en-653" name="tutorial_en/tutorial_en.catala_en-653"></a><span class="s">      </span><span class="kr">equals</span>
<a id="tutorial_en/tutorial_en.catala_en-654" name="tutorial_en/tutorial_en.catala_en-654"></a><span class="s">        </span><span class="kd">output</span><span class="s"> </span><span class="nv">of</span><span class="s"> </span><span class="nc">NewIncomeTaxComputationFixed</span><span class="s"> </span><span class="kr">with</span><span class="s"> </span><span class="o">{</span>
<a id="tutorial_en/tutorial_en.catala_en-655" name="tutorial_en/tutorial_en.catala_en-655"></a><span class="s">          </span><span class="o">--</span><span class="s"> </span><span class="nv">individual</span><span class="o">:</span><span class="s"> </span><span class="nv">individual</span>
<a id="tutorial_en/tutorial_en.catala_en-656" name="tutorial_en/tutorial_en.catala_en-656"></a><span class="s">        </span><span class="o">}</span>
<a id="tutorial_en/tutorial_en.catala_en-657" name="tutorial_en/tutorial_en.catala_en-657"></a><span class="s">      </span><span class="kr">in</span><span class="s"> </span><span class="nv">result_of_tax_computation</span><span class="o">.</span><span class="s">income_tax</span>
<a id="tutorial_en/tutorial_en.catala_en-658" name="tutorial_en/tutorial_en.catala_en-658"></a><span class="s">    </span><span class="kd">else</span><span class="s"> </span><span class="o">$</span><span class="mi">0</span><span class="c1"> # Insert some other modes of computation here</span>
</pre></div></td></tr></table></div>

</div>
<div class='law-text'><p>There are three important bits here: - the
<code>output of NewIncomeTaxComputationFixed with { ... }</code> is the
most interesting part: it triggers a call of the named scope while
setting its input variable <code>individual</code> - it is wrapped in a
<code>let &lt;name&gt; equals &lt;expression&gt; in ...</code> construct
we haven’t seen yet: this allows us to give a name to the result of the
call so that we can refer to it within the last part -
<code>result_of_tax_computation.income_tax</code> re-uses the name we
have just been defining, which holds the results of the scope call, and
retrieves the output of the scope we are interested in, here
<code>income_tax</code></p>
<p>You can check that <code>income_tax</code> was defined as an output
with content <code>money</code>, which matches what we are expecting
here.</p></div>

<h3 class='law-heading' id="The%20Catala%20language%20tutorial-Defining%20exceptions%20to%20rules-Implicit%20scope%20structures,%20and%20output%20scopes"><a href="#The%20Catala%20language%20tutorial-Defining%20exceptions%20to%20rules-Implicit%20scope%20structures,%20and%20output%20scopes">Implicit scope structures, and output scopes</a></h3>

<div class='law-text'><p>It’s not by chance that
<code>result_of_tax_computation.income_tax</code> looks similar to the
way we access a field in a structure: in fact, when defining any scope
(here we are concerned with <code>NewIncomeTaxComputationFixed</code>) a
structure with the same name, and containing all of its outputs as
fields, was automatically defined by Catala. In our case there is just
one output, so the structure <code>NewIncomeTaxComputationFixed</code>
has a single field <code>data income_tax content money</code>.</p>
<p>The <code>result_of_tax_computation</code> intermediate name in
practice holds this structure, as returned by the direct scope call. And
the <code>.income_tax</code> syntax is indeed an access to the
<code>income_tax</code> field of this structure.</p>
<p>In addition, when declaring a subscope, it is possible to prefix it
with <code>output</code>:</p></div>
<div class='code-wrapper catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-693">693</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-694">694</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-695">695</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-696">696</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-697">697</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-698">698</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-699">699</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-700">700</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-693" name="tutorial_en/tutorial_en.catala_en-693"></a><span class="kr">declaration</span><span class="s"> </span><span class="kr">scope</span><span class="s"> </span><span class="nc">Test4bis</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-694" name="tutorial_en/tutorial_en.catala_en-694"></a><span class="s">  </span><span class="kd">output</span><span class="s"> </span><span class="nv">tax_computation</span><span class="s"> </span><span class="kr">scope</span><span class="s"> </span><span class="nc">NewIncomeTaxComputationFixed</span>
<a id="tutorial_en/tutorial_en.catala_en-695" name="tutorial_en/tutorial_en.catala_en-695"></a>
<a id="tutorial_en/tutorial_en.catala_en-696" name="tutorial_en/tutorial_en.catala_en-696"></a><span class="kr">scope</span><span class="s"> </span><span class="nc">Test4bis</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-697" name="tutorial_en/tutorial_en.catala_en-697"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">tax_computation</span><span class="o">.</span><span class="s">individual </span><span class="kr">equals</span><span class="s"> </span><span class="nc">Individual</span><span class="s"> </span><span class="o">{</span>
<a id="tutorial_en/tutorial_en.catala_en-698" name="tutorial_en/tutorial_en.catala_en-698"></a><span class="s">    </span><span class="o">--</span><span class="s"> </span><span class="nv">income</span><span class="o">:</span><span class="s"> </span><span class="o">$</span><span class="mi">7,000</span>
<a id="tutorial_en/tutorial_en.catala_en-699" name="tutorial_en/tutorial_en.catala_en-699"></a><span class="s">    </span><span class="o">--</span><span class="s"> </span><span class="nv">number_of_children</span><span class="o">:</span><span class="s"> </span><span class="mi">7</span>
<a id="tutorial_en/tutorial_en.catala_en-700" name="tutorial_en/tutorial_en.catala_en-700"></a><span class="s">  </span><span class="o">}</span>
</pre></div></td></tr></table></div>

</div>
<div class='law-text'><p>Besides defining the subscope, this declares
<code>tax_computation</code> as an output variable that will contain the
structure holding the outputs of
<code>NewIncomeTaxComputationFixed</code>.</p>
<pre class="catala-test-inline"><code>$ catala interpret --scope Test4bis --disable-warnings
┌─[RESULT]─
│ tax_computation =
│   NewIncomeTaxComputationFixed {
│     -- tax_formula: &lt;function&gt;
│     -- income_tax: $0.00
│   }
└─</code></pre></div>

</details>
<h2 class='law-heading' id="The%20Catala%20language%20tutorial-Context%20scope%20variables"><a href="#The%20Catala%20language%20tutorial-Context%20scope%20variables">Context scope variables</a></h2>
<details><summary>Context scope variables</summary>
<div class='law-text'><p>With its “input”,“output” and “internal” variables, Catala’s scope
are close to regular functions with arguments, local variables and
output. However, the law can sometimes be adversarial to good
programming practices and define provisions that break the abstraction
barrier normally associated to a function.</p>
<p>This can be the case when an outside body of legislative text
“reuses” a a legal concept but adding a twist on it. Consider the
following fictionnal (but not quite pathological computational-wise)
example.</p></div>
<h3 class='law-heading' id="The%20Catala%20language%20tutorial-Context%20scope%20variables-Article%207"><a href="#The%20Catala%20language%20tutorial-Context%20scope%20variables-Article%207">Article 7</a></h3>

<div class='law-text'><p>The justice system delivers fines to individuals when they committed
an offense. The fines are determined based on the amount of taxes paid
by the individual. The more taxes the invidual pays, the higher the
fine. However, the determination of the amount of taxes paid by an
individual in this context shall include a flat tax fee of $500 for
individuals earning less than $10,000.</p></div>
<div class='code-wrapper catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-739">739</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-740">740</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-741">741</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-742">742</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-743">743</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-744">744</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-745">745</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-746">746</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-747">747</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-748">748</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-749">749</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-750">750</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-751">751</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-752">752</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-753">753</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-754">754</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-755">755</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-756">756</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-757">757</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-758">758</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-759">759</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-760">760</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-761">761</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-762">762</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-763">763</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-764">764</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-765">765</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-766">766</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-767">767</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-768">768</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-769">769</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-770">770</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-771">771</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-772">772</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-773">773</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-774">774</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-775">775</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-776">776</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-777">777</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-778">778</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-739" name="tutorial_en/tutorial_en.catala_en-739"></a><span class="c1"># To compute the basis determined for issuing the fines, we create a new scope.</span>
<a id="tutorial_en/tutorial_en.catala_en-740" name="tutorial_en/tutorial_en.catala_en-740"></a><span class="kr">declaration</span><span class="s"> </span><span class="kr">scope</span><span class="s"> </span><span class="nc">BasisForFineDetermination</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-741" name="tutorial_en/tutorial_en.catala_en-741"></a><span class="s">  </span><span class="nv">tax_computation</span><span class="s"> </span><span class="kr">scope</span><span class="s"> </span><span class="nc">NewIncomeTaxComputationFixed</span>
<a id="tutorial_en/tutorial_en.catala_en-742" name="tutorial_en/tutorial_en.catala_en-742"></a><span class="c1">  # This scope will call the NewIncomeTaxComputationFixed scope that defines</span>
<a id="tutorial_en/tutorial_en.catala_en-743" name="tutorial_en/tutorial_en.catala_en-743"></a><span class="c1">  # the proper tax computation.</span>
<a id="tutorial_en/tutorial_en.catala_en-744" name="tutorial_en/tutorial_en.catala_en-744"></a><span class="s">  </span><span class="kd">input</span><span class="s"> </span><span class="nv">individual</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="nc">Individual</span>
<a id="tutorial_en/tutorial_en.catala_en-745" name="tutorial_en/tutorial_en.catala_en-745"></a><span class="s">  </span><span class="kd">output</span><span class="s"> </span><span class="nv">basis_for_fine</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">money</span>
<a id="tutorial_en/tutorial_en.catala_en-746" name="tutorial_en/tutorial_en.catala_en-746"></a>
<a id="tutorial_en/tutorial_en.catala_en-747" name="tutorial_en/tutorial_en.catala_en-747"></a><span class="kr">scope</span><span class="s"> </span><span class="nc">BasisForFineDetermination</span><span class="s"> </span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-748" name="tutorial_en/tutorial_en.catala_en-748"></a><span class="c1">  # First, we link the inputs and outputs of the two scopes.</span>
<a id="tutorial_en/tutorial_en.catala_en-749" name="tutorial_en/tutorial_en.catala_en-749"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">tax_computation</span><span class="o">.</span><span class="s">individual </span><span class="kr">equals</span><span class="s"> </span><span class="nv">individual</span>
<a id="tutorial_en/tutorial_en.catala_en-750" name="tutorial_en/tutorial_en.catala_en-750"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">basis_for_fine</span><span class="s"> </span><span class="kr">equals</span><span class="s"> </span><span class="nv">tax_computation</span><span class="o">.</span><span class="s">income_tax</span>
<a id="tutorial_en/tutorial_en.catala_en-751" name="tutorial_en/tutorial_en.catala_en-751"></a>
<a id="tutorial_en/tutorial_en.catala_en-752" name="tutorial_en/tutorial_en.catala_en-752"></a><span class="c1">  # But then, how to account for the provision of the law that reverts the</span>
<a id="tutorial_en/tutorial_en.catala_en-753" name="tutorial_en/tutorial_en.catala_en-753"></a><span class="c1">  # mechanism canceling taxes for individuals earning less than $10,000 dollars?</span>
<a id="tutorial_en/tutorial_en.catala_en-754" name="tutorial_en/tutorial_en.catala_en-754"></a>
<a id="tutorial_en/tutorial_en.catala_en-755" name="tutorial_en/tutorial_en.catala_en-755"></a><span class="c1">  # This is where the &quot;context&quot; concept comes into play. Indeed, we had</span>
<a id="tutorial_en/tutorial_en.catala_en-756" name="tutorial_en/tutorial_en.catala_en-756"></a><span class="c1">  # annotated the &quot;income_tax&quot; variable of &quot;NewIncomeTaxComputationFixed&quot; with</span>
<a id="tutorial_en/tutorial_en.catala_en-757" name="tutorial_en/tutorial_en.catala_en-757"></a><span class="c1">  # the &quot;context&quot; attribute. &quot;context&quot; is a variant of &quot;input&quot; that exposes the</span>
<a id="tutorial_en/tutorial_en.catala_en-758" name="tutorial_en/tutorial_en.catala_en-758"></a><span class="c1">  # variable as an input of the scope. However, it is more permissive than</span>
<a id="tutorial_en/tutorial_en.catala_en-759" name="tutorial_en/tutorial_en.catala_en-759"></a><span class="c1">  # &quot;input&quot; because it lets you re-define the &quot;context&quot; variable inside its</span>
<a id="tutorial_en/tutorial_en.catala_en-760" name="tutorial_en/tutorial_en.catala_en-760"></a><span class="c1">  # own scope. Then, you&#39;re faced with a choice for the value of &quot;income_tax&quot;:</span>
<a id="tutorial_en/tutorial_en.catala_en-761" name="tutorial_en/tutorial_en.catala_en-761"></a><span class="c1">  # do you take the value coming from its definition inside</span>
<a id="tutorial_en/tutorial_en.catala_en-762" name="tutorial_en/tutorial_en.catala_en-762"></a><span class="c1">  # &quot;NewIncomeTaxComputationFixed&quot; or do you take the value coming from the</span>
<a id="tutorial_en/tutorial_en.catala_en-763" name="tutorial_en/tutorial_en.catala_en-763"></a><span class="c1">  # input of the scope? This dilemma is resolved in two ways. First, by looking</span>
<a id="tutorial_en/tutorial_en.catala_en-764" name="tutorial_en/tutorial_en.catala_en-764"></a><span class="c1">  # at the conditions of the definitions: only definitions that have a condition</span>
<a id="tutorial_en/tutorial_en.catala_en-765" name="tutorial_en/tutorial_en.catala_en-765"></a><span class="c1">  # evaluating to &quot;true&quot; at runtime will be considered. If there&#39;s only one,</span>
<a id="tutorial_en/tutorial_en.catala_en-766" name="tutorial_en/tutorial_en.catala_en-766"></a><span class="c1">  # the pick is easy. But what if two definitions trigger at the same time,</span>
<a id="tutorial_en/tutorial_en.catala_en-767" name="tutorial_en/tutorial_en.catala_en-767"></a><span class="c1">  # one from the input and one from the &quot;NewIncomeTaxComputationFixed&quot; scope?</span>
<a id="tutorial_en/tutorial_en.catala_en-768" name="tutorial_en/tutorial_en.catala_en-768"></a><span class="c1">  # Well, second, in that case we always prioritize the input definition for</span>
<a id="tutorial_en/tutorial_en.catala_en-769" name="tutorial_en/tutorial_en.catala_en-769"></a><span class="c1">  # picking. In Catala, the caller scope has priority over the callee scope</span>
<a id="tutorial_en/tutorial_en.catala_en-770" name="tutorial_en/tutorial_en.catala_en-770"></a><span class="c1">  # for &quot;context&quot; variable. It&#39;s as if the caller provided an extra exception</span>
<a id="tutorial_en/tutorial_en.catala_en-771" name="tutorial_en/tutorial_en.catala_en-771"></a><span class="c1">  # for the definition of the scope variable.</span>
<a id="tutorial_en/tutorial_en.catala_en-772" name="tutorial_en/tutorial_en.catala_en-772"></a>
<a id="tutorial_en/tutorial_en.catala_en-773" name="tutorial_en/tutorial_en.catala_en-773"></a><span class="c1">  # Back to our little problem, the solution is here to provide from the outside</span>
<a id="tutorial_en/tutorial_en.catala_en-774" name="tutorial_en/tutorial_en.catala_en-774"></a><span class="c1">  # an exceptional definition for income tax for people earning less than</span>
<a id="tutorial_en/tutorial_en.catala_en-775" name="tutorial_en/tutorial_en.catala_en-775"></a><span class="c1">  # $10,0000.</span>
<a id="tutorial_en/tutorial_en.catala_en-776" name="tutorial_en/tutorial_en.catala_en-776"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">tax_computation</span><span class="o">.</span><span class="s">income_tax </span><span class="kr">under condition</span>
<a id="tutorial_en/tutorial_en.catala_en-777" name="tutorial_en/tutorial_en.catala_en-777"></a><span class="s">    </span><span class="nv">individual</span><span class="o">.</span><span class="s">income </span><span class="o">&lt;=</span><span class="s"> </span><span class="o">$</span><span class="mi">10,000</span>
<a id="tutorial_en/tutorial_en.catala_en-778" name="tutorial_en/tutorial_en.catala_en-778"></a><span class="s">  </span><span class="kr">consequence</span><span class="s"> </span><span class="kr">equals</span><span class="s"> </span><span class="o">$</span><span class="mi">500</span>
</pre></div></td></tr></table></div>

</div>


</details>
<h2 class='law-heading' id="The%20Catala%20language%20tutorial-One%20variable,%20multiple%20states"><a href="#The%20Catala%20language%20tutorial-One%20variable,%20multiple%20states">One variable, multiple states</a></h2>
<details><summary>One variable, multiple states</summary>
<div class='law-text'><p>When a quantity is mentioned in the law, it does not always maps
exactly to a unique Catala variable. More precisely, it often happens
that the law defines a unique quantity with multiple computation steps,
each new one building on the previous one. Here is an example of such a
setup and how to deal with it thanks to a dedicated Catala feature.</p>
<p>Under the hood, the different states of a Catala variable are
implemented by distinct variables inside the lower intermediate
representations of the language.</p></div>
<h3 class='law-heading' id="The%20Catala%20language%20tutorial-One%20variable,%20multiple%20states-Article%208"><a href="#The%20Catala%20language%20tutorial-One%20variable,%20multiple%20states-Article%208">Article 8</a></h3>

<div class='law-text'><p>For taxation purposes, the values of the building operated for
charity purposes can be deducted from the wealth of the individual,
which is then capped at $2,500,000.</p></div>
<div class='code-wrapper catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-800">800</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-801">801</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-802">802</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-803">803</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-804">804</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-805">805</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-806">806</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-807">807</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-808">808</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-809">809</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-810">810</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-811">811</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-812">812</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-813">813</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-814">814</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-815">815</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-816">816</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-817">817</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-818">818</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-819">819</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-820">820</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-821">821</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-822">822</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-800" name="tutorial_en/tutorial_en.catala_en-800"></a><span class="kr">declaration</span><span class="s"> </span><span class="kr">scope</span><span class="s"> </span><span class="nc">WealthTax</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-801" name="tutorial_en/tutorial_en.catala_en-801"></a><span class="s">  </span><span class="kd">input</span><span class="s"> </span><span class="nv">value_of_buildings_used_for_charity</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">money</span>
<a id="tutorial_en/tutorial_en.catala_en-802" name="tutorial_en/tutorial_en.catala_en-802"></a><span class="s">  </span><span class="kd">input</span><span class="s"> </span><span class="nv">total_wealth</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">money</span>
<a id="tutorial_en/tutorial_en.catala_en-803" name="tutorial_en/tutorial_en.catala_en-803"></a><span class="s">  </span><span class="kd">internal</span><span class="s"> </span><span class="nv">wealth</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">money</span>
<a id="tutorial_en/tutorial_en.catala_en-804" name="tutorial_en/tutorial_en.catala_en-804"></a><span class="c1">    # After the type of the variable, we can define the ordered list of states</span>
<a id="tutorial_en/tutorial_en.catala_en-805" name="tutorial_en/tutorial_en.catala_en-805"></a><span class="c1">    # that the variable shall take before computing its final value. In each</span>
<a id="tutorial_en/tutorial_en.catala_en-806" name="tutorial_en/tutorial_en.catala_en-806"></a><span class="c1">    # state, we&#39;ll be able to refer to the value of the previous state.</span>
<a id="tutorial_en/tutorial_en.catala_en-807" name="tutorial_en/tutorial_en.catala_en-807"></a><span class="s">    </span><span class="kr">state</span><span class="s"> </span><span class="nv">total</span>
<a id="tutorial_en/tutorial_en.catala_en-808" name="tutorial_en/tutorial_en.catala_en-808"></a><span class="s">    </span><span class="kr">state</span><span class="s"> </span><span class="nv">after_charity_deductions</span>
<a id="tutorial_en/tutorial_en.catala_en-809" name="tutorial_en/tutorial_en.catala_en-809"></a><span class="s">    </span><span class="kr">state</span><span class="s"> </span><span class="nv">after_capping</span>
<a id="tutorial_en/tutorial_en.catala_en-810" name="tutorial_en/tutorial_en.catala_en-810"></a>
<a id="tutorial_en/tutorial_en.catala_en-811" name="tutorial_en/tutorial_en.catala_en-811"></a><span class="kr">scope</span><span class="s"> </span><span class="nc">WealthTax</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-812" name="tutorial_en/tutorial_en.catala_en-812"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">wealth</span><span class="s"> </span><span class="kr">state</span><span class="s"> </span><span class="nv">total</span><span class="s"> </span><span class="kr">equals</span><span class="s"> </span><span class="nv">total_wealth</span>
<a id="tutorial_en/tutorial_en.catala_en-813" name="tutorial_en/tutorial_en.catala_en-813"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">wealth</span><span class="s"> </span><span class="kr">state</span><span class="s"> </span><span class="nv">after_charity_deductions</span><span class="s"> </span><span class="kr">equals</span>
<a id="tutorial_en/tutorial_en.catala_en-814" name="tutorial_en/tutorial_en.catala_en-814"></a><span class="s">    </span><span class="nv">wealth</span><span class="s"> </span><span class="o">-</span><span class="c1"> # Here, &quot;wealth&quot; refers to the state &quot;total&quot;</span>
<a id="tutorial_en/tutorial_en.catala_en-815" name="tutorial_en/tutorial_en.catala_en-815"></a><span class="s">      </span><span class="nv">value_of_buildings_used_for_charity</span>
<a id="tutorial_en/tutorial_en.catala_en-816" name="tutorial_en/tutorial_en.catala_en-816"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">wealth</span><span class="s"> </span><span class="kr">state</span><span class="s"> </span><span class="nv">after_capping</span><span class="s"> </span><span class="kr">equals</span>
<a id="tutorial_en/tutorial_en.catala_en-817" name="tutorial_en/tutorial_en.catala_en-817"></a><span class="s">    </span><span class="kd">if</span><span class="s"> </span><span class="nv">wealth</span><span class="s"> </span><span class="o">&gt;=</span><span class="s"> </span><span class="o">$</span><span class="mi">2,500</span><span class="o">,</span><span class="mi">000</span><span class="s"> </span><span class="kd">then</span><span class="s"> </span><span class="o">$</span><span class="mi">2,500</span><span class="o">,</span><span class="mi">000</span><span class="s"> </span><span class="kd">else</span><span class="s"> </span><span class="nv">wealth</span>
<a id="tutorial_en/tutorial_en.catala_en-818" name="tutorial_en/tutorial_en.catala_en-818"></a><span class="c1">    # Here, &quot;wealth&quot; refers to the state &quot;after_charity_decuctions&quot;</span>
<a id="tutorial_en/tutorial_en.catala_en-819" name="tutorial_en/tutorial_en.catala_en-819"></a>
<a id="tutorial_en/tutorial_en.catala_en-820" name="tutorial_en/tutorial_en.catala_en-820"></a><span class="s">  </span><span class="kr">assertion</span><span class="s"> </span><span class="nv">wealth</span><span class="s"> </span><span class="o">&gt;</span><span class="s"> </span><span class="o">$</span><span class="mi">0</span>
<a id="tutorial_en/tutorial_en.catala_en-821" name="tutorial_en/tutorial_en.catala_en-821"></a><span class="c1">  # this refers to the final state of the variable, here &quot;after_capping&quot;.</span>
<a id="tutorial_en/tutorial_en.catala_en-822" name="tutorial_en/tutorial_en.catala_en-822"></a>
</pre></div></td></tr></table></div>

</div>

<h4 class='law-heading' id="The%20Catala%20language%20tutorial-One%20variable,%20multiple%20states-Article%208-Accessing%20states"><a href="#The%20Catala%20language%20tutorial-One%20variable,%20multiple%20states-Article%208-Accessing%20states">Accessing states</a></h4>

<div class='law-text'><p>Any references to <code>wealth</code> outside of its definition would
refer to its last, or “outcome” state (any <em>definitions</em> of
<code>wealth</code>, if it were the case the variable was marked
<code>input</code> or <code>context</code>, would obviously affect its
first, or “starting” state). But it may happen that the law explicitely
refers to the “uncapped wealth after charity reductions”. This can be
accessed by explicitely writing
<code>wealth state after_charity_deductions</code>.</p>
<p>There are two limitations to this: - it is only available within the
scope the variable is defined in: even if <code>wealth</code> were an
output, its intermediate states remain opaque to the outside. - it is
not allowed within definitions of the variable itself, where the
preceding state is always implicitely used.</p></div>


</details>
<h2 class='law-heading' id="The%20Catala%20language%20tutorial-Catala%20values"><a href="#The%20Catala%20language%20tutorial-Catala%20values">Catala values</a></h2>
<details><summary>Catala values</summary>
<div class='law-text'><p>So far, this tutorial has introduced you to the basic structure of
Catala programs with scope, definitions and exceptions. But to be able
to handle most statutes, Catala comes with support for the usual types
of values on which legislative computations operate.</p></div>
<h3 class='law-heading' id="The%20Catala%20language%20tutorial-Catala%20values-Booleans"><a href="#The%20Catala%20language%20tutorial-Catala%20values-Booleans">Booleans</a></h3>

<div class='law-text'><p>Booleans are the most basic type of value in Catala: they can be
either true or false. Conditions are simply booleans with a default
value of false, see the section about conditions above.</p></div>
<div class='code-wrapper catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-854">854</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-855">855</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-856">856</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-857">857</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-858">858</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-859">859</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-860">860</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-861">861</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-862">862</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-863">863</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-854" name="tutorial_en/tutorial_en.catala_en-854"></a><span class="kr">declaration</span><span class="s"> </span><span class="kr">scope</span><span class="s"> </span><span class="nc">BooleanValues</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-855" name="tutorial_en/tutorial_en.catala_en-855"></a><span class="s">  </span><span class="kd">output</span><span class="s"> </span><span class="nv">value1</span><span class="s"> </span><span class="kr">condition</span>
<a id="tutorial_en/tutorial_en.catala_en-856" name="tutorial_en/tutorial_en.catala_en-856"></a><span class="s">  </span><span class="kd">output</span><span class="s"> </span><span class="nv">value2</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">boolean</span>
<a id="tutorial_en/tutorial_en.catala_en-857" name="tutorial_en/tutorial_en.catala_en-857"></a>
<a id="tutorial_en/tutorial_en.catala_en-858" name="tutorial_en/tutorial_en.catala_en-858"></a><span class="kr">scope</span><span class="s"> </span><span class="nc">BooleanValues</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-859" name="tutorial_en/tutorial_en.catala_en-859"></a><span class="s">  </span><span class="kr">rule</span><span class="s"> </span><span class="nv">value1</span><span class="s"> </span><span class="kr">under condition</span><span class="s"> </span><span class="kc">false</span><span class="s"> </span><span class="o">and</span><span class="s"> </span><span class="kc">true</span><span class="s"> </span><span class="kr">consequence</span><span class="s"> </span><span class="kr">fulfilled</span>
<a id="tutorial_en/tutorial_en.catala_en-860" name="tutorial_en/tutorial_en.catala_en-860"></a><span class="c1">  # Sets the boolean of the value1 condition to &quot;true&quot; under condition</span>
<a id="tutorial_en/tutorial_en.catala_en-861" name="tutorial_en/tutorial_en.catala_en-861"></a><span class="c1">  # &quot;false and true&quot;</span>
<a id="tutorial_en/tutorial_en.catala_en-862" name="tutorial_en/tutorial_en.catala_en-862"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">value2</span><span class="s"> </span><span class="kr">equals</span><span class="s"> </span><span class="nv">value1</span><span class="s"> </span><span class="o">xor</span><span class="s"> </span><span class="o">(</span><span class="nv">value1</span><span class="s"> </span><span class="o">and</span><span class="s"> </span><span class="kc">true</span><span class="o">)</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="kc">false</span>
<a id="tutorial_en/tutorial_en.catala_en-863" name="tutorial_en/tutorial_en.catala_en-863"></a><span class="c1">  # Boolean operators include and, or, xor</span>
</pre></div></td></tr></table></div>

</div>


<h3 class='law-heading' id="The%20Catala%20language%20tutorial-Catala%20values-Integers"><a href="#The%20Catala%20language%20tutorial-Catala%20values-Integers">Integers</a></h3>

<div class='law-text'><p>Integers in Catala are infinite precision: they behave like true
mathematical integers, and not like computer integers that are bounded
by a maximum value due to them being stored in 32 or 64 bits. Integers
can be negative.</p></div>
<div class='code-wrapper catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-873">873</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-874">874</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-875">875</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-876">876</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-877">877</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-878">878</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-879">879</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-873" name="tutorial_en/tutorial_en.catala_en-873"></a><span class="kr">declaration</span><span class="s"> </span><span class="kr">scope</span><span class="s"> </span><span class="nc">IntegerValues</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-874" name="tutorial_en/tutorial_en.catala_en-874"></a><span class="s">  </span><span class="kd">output</span><span class="s"> </span><span class="nv">value1</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">integer</span>
<a id="tutorial_en/tutorial_en.catala_en-875" name="tutorial_en/tutorial_en.catala_en-875"></a><span class="s">  </span><span class="kd">output</span><span class="s"> </span><span class="nv">value2</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">integer</span>
<a id="tutorial_en/tutorial_en.catala_en-876" name="tutorial_en/tutorial_en.catala_en-876"></a>
<a id="tutorial_en/tutorial_en.catala_en-877" name="tutorial_en/tutorial_en.catala_en-877"></a><span class="kr">scope</span><span class="s"> </span><span class="nc">IntegerValues</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-878" name="tutorial_en/tutorial_en.catala_en-878"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">value1</span><span class="s"> </span><span class="kr">under condition</span><span class="s"> </span><span class="mi">12</span><span class="s"> </span><span class="o">-</span><span class="s"> </span><span class="o">(</span><span class="mi">5</span><span class="s"> </span><span class="o">*</span><span class="s"> </span><span class="mi">3</span><span class="o">)</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="mi">65</span><span class="s"> </span><span class="kr">consequence</span><span class="s"> </span><span class="kr">equals</span><span class="s"> </span><span class="mi">45</span><span class="s"> </span><span class="o">*</span><span class="s"> </span><span class="mi">9</span>
<a id="tutorial_en/tutorial_en.catala_en-879" name="tutorial_en/tutorial_en.catala_en-879"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">value2</span><span class="s"> </span><span class="kr">equals</span><span class="s"> </span><span class="nv">value1</span><span class="s"> </span><span class="o">*</span><span class="s"> </span><span class="nv">value1</span><span class="s"> </span><span class="o">*</span><span class="s"> </span><span class="mi">65</span><span class="s"> </span><span class="o">*</span><span class="s"> </span><span class="mi">100</span>
</pre></div></td></tr></table></div>

</div>


<h3 class='law-heading' id="The%20Catala%20language%20tutorial-Catala%20values-Decimals"><a href="#The%20Catala%20language%20tutorial-Catala%20values-Decimals">Decimals</a></h3>

<div class='law-text'><p>Decimals in Catala also have infinite precisions, behaving like true
mathematical rational numbers, and not like computer floating point
numbers that perform approximate computations.</p></div>
<div class='code-wrapper catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-889">889</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-890">890</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-891">891</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-892">892</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-893">893</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-894">894</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-895">895</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-896">896</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-897">897</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-898">898</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-899">899</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-900">900</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-889" name="tutorial_en/tutorial_en.catala_en-889"></a><span class="kr">declaration</span><span class="s"> </span><span class="kr">scope</span><span class="s"> </span><span class="nc">DecimalValues</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-890" name="tutorial_en/tutorial_en.catala_en-890"></a><span class="s">  </span><span class="kd">output</span><span class="s"> </span><span class="nv">value1</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">decimal</span>
<a id="tutorial_en/tutorial_en.catala_en-891" name="tutorial_en/tutorial_en.catala_en-891"></a><span class="s">  </span><span class="kd">output</span><span class="s"> </span><span class="nv">value2</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">decimal</span>
<a id="tutorial_en/tutorial_en.catala_en-892" name="tutorial_en/tutorial_en.catala_en-892"></a>
<a id="tutorial_en/tutorial_en.catala_en-893" name="tutorial_en/tutorial_en.catala_en-893"></a><span class="kr">scope</span><span class="s"> </span><span class="nc">DecimalValues</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-894" name="tutorial_en/tutorial_en.catala_en-894"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">value1</span><span class="s"> </span><span class="kr">under condition</span>
<a id="tutorial_en/tutorial_en.catala_en-895" name="tutorial_en/tutorial_en.catala_en-895"></a><span class="s">    </span><span class="mi">12</span><span class="o">.</span><span class="mi">655465446655426</span><span class="s"> </span><span class="o">-</span><span class="s"> </span><span class="mi">0</span><span class="o">.</span><span class="mi">45265426541654</span><span class="s">  </span><span class="o">&lt;</span><span class="s"> </span><span class="mi">12</span><span class="o">.</span><span class="mi">3554654652</span><span class="s"> </span><span class="kr">consequence</span>
<a id="tutorial_en/tutorial_en.catala_en-896" name="tutorial_en/tutorial_en.catala_en-896"></a><span class="s">  </span><span class="kr">equals</span><span class="s"> </span><span class="mi">45</span><span class="s"> </span><span class="o">/</span><span class="s"> </span><span class="mi">8</span>
<a id="tutorial_en/tutorial_en.catala_en-897" name="tutorial_en/tutorial_en.catala_en-897"></a><span class="c1">  # The / operator corresponds to an exact division. The division of integers</span>
<a id="tutorial_en/tutorial_en.catala_en-898" name="tutorial_en/tutorial_en.catala_en-898"></a><span class="c1">  # yields a decimal.</span>
<a id="tutorial_en/tutorial_en.catala_en-899" name="tutorial_en/tutorial_en.catala_en-899"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">value2</span><span class="s"> </span><span class="kr">equals</span><span class="s"> </span><span class="nv">value1</span><span class="s"> </span><span class="o">*</span><span class="s"> </span><span class="nv">value1</span><span class="s"> </span><span class="o">*</span><span class="s"> </span><span class="mi">65</span><span class="o">%</span>
<a id="tutorial_en/tutorial_en.catala_en-900" name="tutorial_en/tutorial_en.catala_en-900"></a><span class="c1">  # Percentages are decimal numbers (0.65 here)</span>
</pre></div></td></tr></table></div>

</div>


<h3 class='law-heading' id="The%20Catala%20language%20tutorial-Catala%20values-Money"><a href="#The%20Catala%20language%20tutorial-Catala%20values-Money">Money</a></h3>

<div class='law-text'><p>In Catala, money is simply represented as an integer number of cents.
You cannot in Catala have a more precise amount of money than a cent.
However, you can muliply an amount of money by a decimal, and the result
is rounded towards the nearest cent. This principled behaviour to keep
track of where you need precision in your computations and select
decimals for precision instead of relying on money figures where
sub-cent precision matters. Two money amounts can be divided, yielding a
decimal.</p></div>
<div class='code-wrapper catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-914">914</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-915">915</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-916">916</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-917">917</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-918">918</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-919">919</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-920">920</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-921">921</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-922">922</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-923">923</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-914" name="tutorial_en/tutorial_en.catala_en-914"></a><span class="kr">declaration</span><span class="s"> </span><span class="kr">scope</span><span class="s"> </span><span class="nc">MoneyValues</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-915" name="tutorial_en/tutorial_en.catala_en-915"></a><span class="s">  </span><span class="kd">output</span><span class="s"> </span><span class="nv">value1</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">decimal</span>
<a id="tutorial_en/tutorial_en.catala_en-916" name="tutorial_en/tutorial_en.catala_en-916"></a><span class="s">  </span><span class="kd">output</span><span class="s"> </span><span class="nv">value2</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">money</span>
<a id="tutorial_en/tutorial_en.catala_en-917" name="tutorial_en/tutorial_en.catala_en-917"></a>
<a id="tutorial_en/tutorial_en.catala_en-918" name="tutorial_en/tutorial_en.catala_en-918"></a><span class="kr">scope</span><span class="s"> </span><span class="nc">MoneyValues</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-919" name="tutorial_en/tutorial_en.catala_en-919"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">value1</span><span class="s"> </span><span class="kr">under condition</span>
<a id="tutorial_en/tutorial_en.catala_en-920" name="tutorial_en/tutorial_en.catala_en-920"></a><span class="s">    </span><span class="mi">12</span><span class="o">.</span><span class="mi">655465446655426</span><span class="s"> </span><span class="o">-</span><span class="s"> </span><span class="mi">0</span><span class="o">.</span><span class="mi">45265426541654</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="mi">12</span><span class="o">.</span><span class="mi">3554654652</span><span class="s"> </span><span class="kr">consequence</span>
<a id="tutorial_en/tutorial_en.catala_en-921" name="tutorial_en/tutorial_en.catala_en-921"></a><span class="s">  </span><span class="kr">equals</span><span class="s"> </span><span class="mi">45</span><span class="s"> </span><span class="o">/</span><span class="s"> </span><span class="mi">8</span>
<a id="tutorial_en/tutorial_en.catala_en-922" name="tutorial_en/tutorial_en.catala_en-922"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">value2</span><span class="s"> </span><span class="kr">equals</span>
<a id="tutorial_en/tutorial_en.catala_en-923" name="tutorial_en/tutorial_en.catala_en-923"></a><span class="s">    </span><span class="o">$</span><span class="mi">1</span><span class="o">.</span><span class="mi">00</span><span class="s"> </span><span class="o">*</span><span class="s"> </span><span class="o">((($</span><span class="mi">6,520</span><span class="o">.</span><span class="mi">23</span><span class="s"> </span><span class="o">-</span><span class="s"> </span><span class="o">$</span><span class="mi">320</span><span class="o">.</span><span class="mi">45</span><span class="o">)</span><span class="s"> </span><span class="o">*</span><span class="s"> </span><span class="nv">value1</span><span class="o">)</span><span class="s"> </span><span class="o">/</span><span class="s"> </span><span class="o">$</span><span class="mi">45</span><span class="o">)</span>
</pre></div></td></tr></table></div>

</div>
<div class='law-text'><p>Multiplying two money amounts is not supported, as it is most likely
to be a coding error ; if processing a computation complex enough to
require it, convert them to decimals first using the syntax
<code>decimal of $1.00</code>.</p></div>

<h3 class='law-heading' id="The%20Catala%20language%20tutorial-Catala%20values-Dates%20and%20durations"><a href="#The%20Catala%20language%20tutorial-Catala%20values-Dates%20and%20durations">Dates and durations</a></h3>

<div class='law-text'><p>Catala has support for Gregorian calendar dates as well as duration
computations in terms of days, months and years. A difference between
dates is a duration measured in days, and the addition of a date and a
duration yields a new date. Durations measured in days, months or years
are not mixable with each other, as months and years do not always have
the same number of days. This non-mixability is not captured by the type
system of Catala but will yield errors at runtime. Date literals are
specified using the ISO 8601 standard to avoid confusion between
american and european notations.</p></div>
<div class='code-wrapper catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-943">943</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-944">944</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-945">945</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-946">946</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-947">947</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-948">948</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-949">949</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-950">950</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-943" name="tutorial_en/tutorial_en.catala_en-943"></a><span class="kr">declaration</span><span class="s"> </span><span class="kr">scope</span><span class="s"> </span><span class="nc">DateValues</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-944" name="tutorial_en/tutorial_en.catala_en-944"></a><span class="s">  </span><span class="kd">output</span><span class="s"> </span><span class="nv">value1</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">date</span>
<a id="tutorial_en/tutorial_en.catala_en-945" name="tutorial_en/tutorial_en.catala_en-945"></a><span class="s">  </span><span class="kd">output</span><span class="s"> </span><span class="nv">value2</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">duration</span>
<a id="tutorial_en/tutorial_en.catala_en-946" name="tutorial_en/tutorial_en.catala_en-946"></a>
<a id="tutorial_en/tutorial_en.catala_en-947" name="tutorial_en/tutorial_en.catala_en-947"></a><span class="kr">scope</span><span class="s"> </span><span class="nc">DateValues</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-948" name="tutorial_en/tutorial_en.catala_en-948"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">value1</span><span class="s"> </span><span class="kr">equals</span><span class="s"> </span><span class="mi">|2000-01-01|</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="mi">1</span><span class="s"> </span><span class="o">year</span><span class="c1"> # yields |2001-01-01|</span>
<a id="tutorial_en/tutorial_en.catala_en-949" name="tutorial_en/tutorial_en.catala_en-949"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">value2</span><span class="s"> </span><span class="kr">equals</span>
<a id="tutorial_en/tutorial_en.catala_en-950" name="tutorial_en/tutorial_en.catala_en-950"></a><span class="s">    </span><span class="o">(</span><span class="nv">value1</span><span class="s"> </span><span class="o">-</span><span class="s"> </span><span class="mi">|1999-12-31|</span><span class="o">)</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="mi">45</span><span class="s"> </span><span class="o">day</span><span class="c1"> # 367 + 45 days (2000 is bissextile)</span>
</pre></div></td></tr></table></div>

</div>

<h4 class='law-heading' id="The%20Catala%20language%20tutorial-Catala%20values-Dates%20and%20durations-Ambiguities"><a href="#The%20Catala%20language%20tutorial-Catala%20values-Dates%20and%20durations-Ambiguities">Ambiguities</a></h4>

<div class='law-text'><p>Date computations can be ambiguous. What’s
<code>|2024-02-29| + 1 year</code> ?</p></div>
<div class='code-wrapper catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-958">958</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-959">959</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-960">960</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-961">961</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-962">962</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-958" name="tutorial_en/tutorial_en.catala_en-958"></a><span class="kr">declaration</span><span class="s"> </span><span class="kr">scope</span><span class="s"> </span><span class="nc">AmbiguousDate</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-959" name="tutorial_en/tutorial_en.catala_en-959"></a><span class="s">  </span><span class="kd">output</span><span class="s"> </span><span class="nv">result</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">date</span>
<a id="tutorial_en/tutorial_en.catala_en-960" name="tutorial_en/tutorial_en.catala_en-960"></a>
<a id="tutorial_en/tutorial_en.catala_en-961" name="tutorial_en/tutorial_en.catala_en-961"></a><span class="kr">scope</span><span class="s"> </span><span class="nc">AmbiguousDate</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-962" name="tutorial_en/tutorial_en.catala_en-962"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">result</span><span class="s"> </span><span class="kr">equals</span><span class="s"> </span><span class="mi">|2000-02-29|</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="mi">1</span><span class="s"> </span><span class="o">year</span>
</pre></div></td></tr></table></div>

</div>
<div class='law-text'><pre class="catala-test-inline"><code>$ catala interpret --scope AmbiguousDate --disable-warnings
┌─[ERROR]─
│
│  Unexpected error: Dates_calc.Dates.AmbiguousComputation
│
└─
#return code 125#</code></pre>
<p>Indeed, there are two possible answers to this, and none is
canonically better than the other. Depending on the jurisdiction or
jurisprudence, you can specify which one is right for the case at hand
as so:</p></div>
<div class='code-wrapper catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-980">980</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-981">981</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-982">982</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-983">983</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-984">984</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-985">985</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-980" name="tutorial_en/tutorial_en.catala_en-980"></a><span class="kr">declaration</span><span class="s"> </span><span class="kr">scope</span><span class="s"> </span><span class="nc">AmbiguousDate2</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-981" name="tutorial_en/tutorial_en.catala_en-981"></a><span class="s">  </span><span class="kd">output</span><span class="s"> </span><span class="nv">result</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">date</span>
<a id="tutorial_en/tutorial_en.catala_en-982" name="tutorial_en/tutorial_en.catala_en-982"></a>
<a id="tutorial_en/tutorial_en.catala_en-983" name="tutorial_en/tutorial_en.catala_en-983"></a><span class="kr">scope</span><span class="s"> </span><span class="nc">AmbiguousDate2</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-984" name="tutorial_en/tutorial_en.catala_en-984"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">result</span><span class="s"> </span><span class="kr">equals</span><span class="s"> </span><span class="mi">|2000-02-29|</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="mi">1</span><span class="s"> </span><span class="o">year</span>
<a id="tutorial_en/tutorial_en.catala_en-985" name="tutorial_en/tutorial_en.catala_en-985"></a><span class="s">  </span><span class="kt">date</span><span class="s"> </span><span class="kd">round</span><span class="s"> </span><span class="kr">decreasing</span><span class="c1">   # or &quot;increasing&quot;</span>
</pre></div></td></tr></table></div>

</div>
<div class='law-text'><pre class="catala-test-inline"><code>$ catala interpret --scope AmbiguousDate2 --disable-warnings
┌─[RESULT]─
│ result = 2001-02-28
└─</code></pre>
<p>Some other cases are always ambiguous and will inevitably result in
an error, like asking whether <code>30 day &lt; 1 month</code>.</p></div>
<div class='code-wrapper catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-999"> 999</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1000">1000</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1001">1001</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1002">1002</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1003">1003</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-999" name="tutorial_en/tutorial_en.catala_en-999"></a><span class="kr">declaration</span><span class="s"> </span><span class="kr">scope</span><span class="s"> </span><span class="nc">AmbiguousDate3</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-1000" name="tutorial_en/tutorial_en.catala_en-1000"></a><span class="s">  </span><span class="kd">output</span><span class="s"> </span><span class="nv">result</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">boolean</span>
<a id="tutorial_en/tutorial_en.catala_en-1001" name="tutorial_en/tutorial_en.catala_en-1001"></a>
<a id="tutorial_en/tutorial_en.catala_en-1002" name="tutorial_en/tutorial_en.catala_en-1002"></a><span class="kr">scope</span><span class="s"> </span><span class="nc">AmbiguousDate3</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-1003" name="tutorial_en/tutorial_en.catala_en-1003"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">result</span><span class="s"> </span><span class="kr">equals</span><span class="s"> </span><span class="mi">30</span><span class="s"> </span><span class="o">day</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="mi">1</span><span class="s"> </span><span class="o">month</span>
</pre></div></td></tr></table></div>

</div>
<div class='law-text'><pre class="catala-test-inline"><code>$ catala interpret --scope AmbiguousDate3 --disable-warnings
┌─[ERROR]─
│
│  During evaluation: ambiguous comparison between durations in different
│  units (e.g. months vs. days).
│
├─➤ tutorial_en/tutorial_en.catala_en:1003.35-1003.36:
│      │
│ 1003 │   definition result equals 30 day &lt; 1 month
│      │                                   ‾
└─ The Catala language tutorial
   └┬ Catala values
    └┬ Dates and durations
     └─ Ambiguities
#return code 123#</code></pre></div>


<h3 class='law-heading' id="The%20Catala%20language%20tutorial-Catala%20values-Lists"><a href="#The%20Catala%20language%20tutorial-Catala%20values-Lists">Lists</a></h3>

<div class='law-text'><p>Often, Catala programs need to work with collections of data because
the law is about the number of children, the maximum of a list, etc.
Catala features first-class support for lists. You can create a list,
filter its elements but also aggregate over its contents to compute all
sorts of values.</p></div>
<div class='code-wrapper catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1033">1033</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1034">1034</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1035">1035</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1036">1036</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1037">1037</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1038">1038</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1039">1039</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1040">1040</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1041">1041</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1042">1042</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1043">1043</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1044">1044</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1045">1045</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1046">1046</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1047">1047</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1048">1048</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1049">1049</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1050">1050</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1051">1051</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1052">1052</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1053">1053</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-1033" name="tutorial_en/tutorial_en.catala_en-1033"></a><span class="kr">declaration</span><span class="s"> </span><span class="kr">scope</span><span class="s"> </span><span class="nc">ListValues</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-1034" name="tutorial_en/tutorial_en.catala_en-1034"></a><span class="s">  </span><span class="kd">internal</span><span class="s"> </span><span class="nv">values</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">list of</span><span class="s"> </span><span class="kt">integer</span>
<a id="tutorial_en/tutorial_en.catala_en-1035" name="tutorial_en/tutorial_en.catala_en-1035"></a><span class="s">  </span><span class="kd">output</span><span class="s"> </span><span class="nv">more_values</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">list of</span><span class="s"> </span><span class="kt">integer</span>
<a id="tutorial_en/tutorial_en.catala_en-1036" name="tutorial_en/tutorial_en.catala_en-1036"></a><span class="s">  </span><span class="kd">output</span><span class="s"> </span><span class="nv">total</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">integer</span>
<a id="tutorial_en/tutorial_en.catala_en-1037" name="tutorial_en/tutorial_en.catala_en-1037"></a><span class="s">  </span><span class="kd">output</span><span class="s"> </span><span class="nv">average</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">decimal</span>
<a id="tutorial_en/tutorial_en.catala_en-1038" name="tutorial_en/tutorial_en.catala_en-1038"></a><span class="s">  </span><span class="kd">output</span><span class="s"> </span><span class="nv">positive_values</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">list of</span><span class="s"> </span><span class="kt">integer</span>
<a id="tutorial_en/tutorial_en.catala_en-1039" name="tutorial_en/tutorial_en.catala_en-1039"></a><span class="s">  </span><span class="kd">output</span><span class="s"> </span><span class="nv">relative_values</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">list of</span><span class="s"> </span><span class="kt">decimal</span>
<a id="tutorial_en/tutorial_en.catala_en-1040" name="tutorial_en/tutorial_en.catala_en-1040"></a>
<a id="tutorial_en/tutorial_en.catala_en-1041" name="tutorial_en/tutorial_en.catala_en-1041"></a><span class="kr">scope</span><span class="s"> </span><span class="nc">ListValues</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-1042" name="tutorial_en/tutorial_en.catala_en-1042"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">values</span><span class="s"> </span><span class="kr">equals</span>
<a id="tutorial_en/tutorial_en.catala_en-1043" name="tutorial_en/tutorial_en.catala_en-1043"></a><span class="s">      </span><span class="o">[</span><span class="s"> </span><span class="mi">45</span><span class="o">;</span><span class="s"> </span><span class="o">-</span><span class="mi">6</span><span class="o">;</span><span class="s"> </span><span class="mi">3</span><span class="o">;</span><span class="s"> </span><span class="mi">4</span><span class="o">;</span><span class="s"> </span><span class="mi">0</span><span class="o">;</span><span class="s"> </span><span class="mi">2155</span><span class="s"> </span><span class="o">]</span>
<a id="tutorial_en/tutorial_en.catala_en-1044" name="tutorial_en/tutorial_en.catala_en-1044"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">more_values</span><span class="s"> </span><span class="kr">equals</span>
<a id="tutorial_en/tutorial_en.catala_en-1045" name="tutorial_en/tutorial_en.catala_en-1045"></a><span class="s">      </span><span class="nv">values</span><span class="s"> </span><span class="o">++</span><span class="s"> </span><span class="o">[</span><span class="s"> </span><span class="mi">1</span><span class="o">;</span><span class="s"> </span><span class="mi">2</span><span class="o">;</span><span class="s"> </span><span class="mi">3</span><span class="o">]</span>
<a id="tutorial_en/tutorial_en.catala_en-1046" name="tutorial_en/tutorial_en.catala_en-1046"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">total</span><span class="s"> </span><span class="kr">equals</span>
<a id="tutorial_en/tutorial_en.catala_en-1047" name="tutorial_en/tutorial_en.catala_en-1047"></a><span class="s">      </span><span class="kd">sum</span><span class="s"> </span><span class="kt">integer</span><span class="s"> </span><span class="kd">of</span><span class="s"> </span><span class="nv">values</span>
<a id="tutorial_en/tutorial_en.catala_en-1048" name="tutorial_en/tutorial_en.catala_en-1048"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">average</span><span class="s"> </span><span class="kr">equals</span>
<a id="tutorial_en/tutorial_en.catala_en-1049" name="tutorial_en/tutorial_en.catala_en-1049"></a><span class="s">      </span><span class="nv">total</span><span class="s"> </span><span class="o">/</span><span class="s"> </span><span class="kd">number</span><span class="s"> </span><span class="kd">of</span><span class="s"> </span><span class="nv">values</span>
<a id="tutorial_en/tutorial_en.catala_en-1050" name="tutorial_en/tutorial_en.catala_en-1050"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">positive_values</span><span class="s"> </span><span class="kr">equals</span>
<a id="tutorial_en/tutorial_en.catala_en-1051" name="tutorial_en/tutorial_en.catala_en-1051"></a><span class="s">      </span><span class="kt">list of</span><span class="s"> </span><span class="nv">x</span><span class="s"> </span><span class="kd">among</span><span class="s"> </span><span class="nv">values</span><span class="s"> </span><span class="kd">such that</span><span class="s"> </span><span class="nv">x</span><span class="s"> </span><span class="o">&gt;=</span><span class="s"> </span><span class="mi">0</span>
<a id="tutorial_en/tutorial_en.catala_en-1052" name="tutorial_en/tutorial_en.catala_en-1052"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">relative_values</span><span class="s"> </span><span class="kr">equals</span>
<a id="tutorial_en/tutorial_en.catala_en-1053" name="tutorial_en/tutorial_en.catala_en-1053"></a><span class="s">      </span><span class="o">(</span><span class="nv">x</span><span class="s"> </span><span class="o">/</span><span class="s"> </span><span class="nv">total</span><span class="o">)</span><span class="s"> </span><span class="kd">for</span><span class="s"> </span><span class="nv">x</span><span class="s"> </span><span class="kd">among</span><span class="s"> </span><span class="nv">values</span>
</pre></div></td></tr></table></div>

</div>


<h3 class='law-heading' id="The%20Catala%20language%20tutorial-Catala%20values-Tuples"><a href="#The%20Catala%20language%20tutorial-Catala%20values-Tuples">Tuples</a></h3>

<div class='law-text'><p>While lists are for variable-size collections of values of the same
type, sometimes it is useful to group together a fixed number of values
of different, known types. These are called pairs when the number is
two, tuples in the general case.</p>
<p>In general, it should be favoured to explicitely declare a named
structure, with named <code>data</code> fields to hold each of those.
But sometimes, for intermediate values, that can become cumbersome.
Elements of a tuple are simply separated by commas, and delimited by
parentheses as so:</p></div>
<div class='code-wrapper catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1069">1069</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1070">1070</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1071">1071</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1072">1072</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1073">1073</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1074">1074</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1075">1075</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-1069" name="tutorial_en/tutorial_en.catala_en-1069"></a><span class="kr">declaration</span><span class="s"> </span><span class="kr">scope</span><span class="s"> </span><span class="nc">UseOfTuple</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-1070" name="tutorial_en/tutorial_en.catala_en-1070"></a><span class="s">  </span><span class="kd">internal</span><span class="s"> </span><span class="nv">money_and_date</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="o">(</span><span class="kt">money</span><span class="o">,</span><span class="s"> </span><span class="kt">date</span><span class="o">)</span>
<a id="tutorial_en/tutorial_en.catala_en-1071" name="tutorial_en/tutorial_en.catala_en-1071"></a><span class="s">  </span><span class="kd">output</span><span class="s"> </span><span class="nv">when</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">date</span>
<a id="tutorial_en/tutorial_en.catala_en-1072" name="tutorial_en/tutorial_en.catala_en-1072"></a>
<a id="tutorial_en/tutorial_en.catala_en-1073" name="tutorial_en/tutorial_en.catala_en-1073"></a><span class="kr">scope</span><span class="s"> </span><span class="nc">UseOfTuple</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-1074" name="tutorial_en/tutorial_en.catala_en-1074"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">money_and_date</span><span class="s"> </span><span class="kr">equals</span><span class="s"> </span><span class="o">($</span><span class="mi">12</span><span class="o">,</span><span class="s"> </span><span class="mi">|2024-01-01|</span><span class="o">)</span>
<a id="tutorial_en/tutorial_en.catala_en-1075" name="tutorial_en/tutorial_en.catala_en-1075"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">when</span><span class="s"> </span><span class="kr">equals</span><span class="s"> </span><span class="nv">money_and_date</span><span class="o">.</span><span class="mi">2</span>
</pre></div></td></tr></table></div>

</div>
<div class='law-text'><p>Access to a member of a tuple is simply done using syntax
<code>.N</code>, where <code>N</code> is the index in the tuple,
starting at 1.</p>
<p>Note that applying a function to multiple arguments or to a tuple is
the same thing (as long as the number and types of the arguments match).
It is even possible to process a tuple of lists as if it were a list of
tuples :</p></div>
<div class='code-wrapper catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1086">1086</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1087">1087</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1088">1088</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1089">1089</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1090">1090</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1091">1091</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1092">1092</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1093">1093</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-1086" name="tutorial_en/tutorial_en.catala_en-1086"></a><span class="kr">declaration</span><span class="s"> </span><span class="kr">scope</span><span class="s"> </span><span class="nc">ApplyRates</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-1087" name="tutorial_en/tutorial_en.catala_en-1087"></a><span class="s">  </span><span class="kd">input</span><span class="s"> </span><span class="nv">values</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">list of</span><span class="s"> </span><span class="kt">money</span>
<a id="tutorial_en/tutorial_en.catala_en-1088" name="tutorial_en/tutorial_en.catala_en-1088"></a><span class="s">  </span><span class="kd">input</span><span class="s"> </span><span class="nv">rates</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">list of</span><span class="s"> </span><span class="kt">decimal</span>
<a id="tutorial_en/tutorial_en.catala_en-1089" name="tutorial_en/tutorial_en.catala_en-1089"></a><span class="s">  </span><span class="kd">output</span><span class="s"> </span><span class="nv">result</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">list of</span><span class="s"> </span><span class="kt">money</span>
<a id="tutorial_en/tutorial_en.catala_en-1090" name="tutorial_en/tutorial_en.catala_en-1090"></a>
<a id="tutorial_en/tutorial_en.catala_en-1091" name="tutorial_en/tutorial_en.catala_en-1091"></a><span class="kr">scope</span><span class="s"> </span><span class="nc">ApplyRates</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-1092" name="tutorial_en/tutorial_en.catala_en-1092"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">result</span><span class="s"> </span><span class="kr">equals</span>
<a id="tutorial_en/tutorial_en.catala_en-1093" name="tutorial_en/tutorial_en.catala_en-1093"></a><span class="s">  </span><span class="o">(</span><span class="nv">v</span><span class="s"> </span><span class="o">*</span><span class="s"> </span><span class="nv">r</span><span class="o">)</span><span class="s"> </span><span class="kd">for</span><span class="s"> </span><span class="o">(</span><span class="nv">v</span><span class="o">,</span><span class="s"> </span><span class="nv">r</span><span class="o">)</span><span class="s"> </span><span class="kd">among</span><span class="s"> </span><span class="o">(</span><span class="nv">values</span><span class="o">,</span><span class="s"> </span><span class="nv">rates</span><span class="o">)</span>
</pre></div></td></tr></table></div>

</div>
<div class='law-text'><p>This will create a new list where the first element is the product of
the first elements of <code>values</code> and <code>rates</code>
respectively, and so on. Be wary that the two lists must be of the same
length, or this would result in a runtime error.</p></div>

</details>
<h2 class='law-heading' id="The%20Catala%20language%20tutorial-Conclusion"><a href="#The%20Catala%20language%20tutorial-Conclusion">Conclusion</a></h2>
<details><summary>Conclusion</summary>
<div class='law-text'><p>This tutorial presents the basic concepts and syntax of the Catala
language features. It is then up to you use them to annotate legislative
texts with their algorithmic translation.</p>
<p>There is no single way to write Catala programs, as the program style
should be adapted to the legislation it annotates. However, Catala is a
functional language at heart, so following standard functional
programming design patterns should help achieve concise and readable
code.</p></div>
</details>


<h1 class='law-heading' id="Annex%20A:%20top-level%20value%20definitions"><a href="#Annex%20A:%20top-level%20value%20definitions">Annex A: top-level value definitions</a></h1>

<div class='law-text'><p>Toplevel definitions provide a way to define values or functions
directly in the program, without putting them in a scope. This is useful
for constants or helper functions, as shown in the examples below.</p>
<p>Toplevel definitions are available by name throughout the program ;
they can depend on each other (as long as there are no cycles), but are
not allowed to rely on any scope evaluations.</p>
<p>They can be useful both for defining constants and pure utility
functions</p></div>
<h2 class='law-heading' id="Annex%20A:%20top-level%20value%20definitions-Examples"><a href="#Annex%20A:%20top-level%20value%20definitions-Examples">Examples</a></h2>
<details><summary>Examples</summary>

<h3 class='law-heading' id="Annex%20A:%20top-level%20value%20definitions-Examples-Defining%20a%20constant"><a href="#Annex%20A:%20top-level%20value%20definitions-Examples-Defining%20a%20constant">Defining a constant</a></h3>

<div class='law-text'><p>« Throughout this corpus, the number of workdays per week is assumed
to be 5. »</p></div>
<div class='code-wrapper catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1132">1132</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1133">1133</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1134">1134</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-1132" name="tutorial_en/tutorial_en.catala_en-1132"></a><span class="kr">declaration</span><span class="s"> </span><span class="nv">workdays_per_week</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">integer</span><span class="s"> </span><span class="kr">equals</span><span class="s"> </span><span class="mi">5</span>
<a id="tutorial_en/tutorial_en.catala_en-1133" name="tutorial_en/tutorial_en.catala_en-1133"></a><span class="c1"># We could declare, then define a scope with a single output variable here, but</span>
<a id="tutorial_en/tutorial_en.catala_en-1134" name="tutorial_en/tutorial_en.catala_en-1134"></a><span class="c1"># it would be pretty verbose.</span>
</pre></div></td></tr></table></div>

</div>


<h3 class='law-heading' id="Annex%20A:%20top-level%20value%20definitions-Examples-Defining%20a%20function%20with%20a%20single%20argument"><a href="#Annex%20A:%20top-level%20value%20definitions-Examples-Defining%20a%20function%20with%20a%20single%20argument">Defining a function with a single argument</a></h3>

<div class='law-text'><p>« […] The final allocation is rounded up to the next multiple of $100
»</p></div>
<div class='code-wrapper catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1142">1142</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1143">1143</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1144">1144</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1145">1145</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1146">1146</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1147">1147</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1148">1148</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-1142" name="tutorial_en/tutorial_en.catala_en-1142"></a><span class="kr">declaration</span><span class="s"> </span><span class="nv">round_up_100</span>
<a id="tutorial_en/tutorial_en.catala_en-1143" name="tutorial_en/tutorial_en.catala_en-1143"></a><span class="s">    </span><span class="kr">content</span><span class="s"> </span><span class="kt">money</span>
<a id="tutorial_en/tutorial_en.catala_en-1144" name="tutorial_en/tutorial_en.catala_en-1144"></a><span class="s">    </span><span class="kr">depends on</span><span class="s"> </span><span class="nv">money_amount</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">money</span>
<a id="tutorial_en/tutorial_en.catala_en-1145" name="tutorial_en/tutorial_en.catala_en-1145"></a><span class="s">  </span><span class="kr">equals</span>
<a id="tutorial_en/tutorial_en.catala_en-1146" name="tutorial_en/tutorial_en.catala_en-1146"></a><span class="s">    </span><span class="kd">round</span><span class="s"> </span><span class="kd">of</span><span class="s"> </span><span class="o">(</span><span class="nv">money_amount</span><span class="s"> </span><span class="o">/</span><span class="s"> </span><span class="mi">100</span><span class="o">.</span><span class="mi">0</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="o">$</span><span class="mi">0</span><span class="o">.</span><span class="mi">49</span><span class="o">)</span><span class="s"> </span><span class="o">*</span><span class="s"> </span><span class="mi">100</span><span class="o">.</span><span class="mi">0</span>
<a id="tutorial_en/tutorial_en.catala_en-1147" name="tutorial_en/tutorial_en.catala_en-1147"></a><span class="c1"># This computation would certainly require some justification where it is</span>
<a id="tutorial_en/tutorial_en.catala_en-1148" name="tutorial_en/tutorial_en.catala_en-1148"></a><span class="c1"># declared.</span>
</pre></div></td></tr></table></div>

</div>
<div class='law-text'><p>The point here is that the computation formula is purely technical,
so once justified where it is written, and when actually needing this
computation in the translation of the law, you just need to write
<code>round_up_100 of value</code>, which is much more
self-explanatory.</p></div>

<h3 class='law-heading' id="Annex%20A:%20top-level%20value%20definitions-Examples-Functions%20with%20multiple%20parameters"><a href="#Annex%20A:%20top-level%20value%20definitions-Examples-Functions%20with%20multiple%20parameters">Functions with multiple parameters</a></h3>

<div class='law-text'><p>« The amount to include in gross income is the excess of the fair
market value of the property over the amount paid. »</p>
<p>Here we could write the formula
<code>if fair_market_value &gt; amount_paid then fair_market_value - amount_paid else $0</code>,
which is the definition of “excess of”. However, it requires careful
reading to make sure there was no mistake, and takes us further from the
law and into technical detail. It’s better to define a named function as
such:</p></div>
<div class='code-wrapper catala-code'>
<div class='filename'>tutorial_en/tutorial_en.catala_en</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1168">1168</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1169">1169</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1170">1170</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1171">1171</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1172">1172</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1173">1173</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1174">1174</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1175">1175</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1176">1176</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1177">1177</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1178">1178</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1179">1179</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1180">1180</a></span>
<span class="normal"><a href="#tutorial_en/tutorial_en.catala_en-1181">1181</a></span>
</pre></div></td><td class="code"><div><pre>
<a id="tutorial_en/tutorial_en.catala_en-1168" name="tutorial_en/tutorial_en.catala_en-1168"></a><span class="kr">declaration</span><span class="s"> </span><span class="nv">excess</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">money</span>
<a id="tutorial_en/tutorial_en.catala_en-1169" name="tutorial_en/tutorial_en.catala_en-1169"></a><span class="s">  </span><span class="kr">depends on</span><span class="s"> </span><span class="nv">x</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">money</span><span class="o">,</span>
<a id="tutorial_en/tutorial_en.catala_en-1170" name="tutorial_en/tutorial_en.catala_en-1170"></a><span class="s">             </span><span class="nv">y</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">money</span>
<a id="tutorial_en/tutorial_en.catala_en-1171" name="tutorial_en/tutorial_en.catala_en-1171"></a><span class="s">  </span><span class="kr">equals</span>
<a id="tutorial_en/tutorial_en.catala_en-1172" name="tutorial_en/tutorial_en.catala_en-1172"></a><span class="s">  </span><span class="kd">if</span><span class="s"> </span><span class="nv">x</span><span class="s"> </span><span class="o">&gt;</span><span class="s"> </span><span class="nv">y</span><span class="s"> </span><span class="kd">then</span><span class="s"> </span><span class="nv">x</span><span class="s"> </span><span class="o">-</span><span class="s"> </span><span class="nv">y</span>
<a id="tutorial_en/tutorial_en.catala_en-1173" name="tutorial_en/tutorial_en.catala_en-1173"></a><span class="s">  </span><span class="kd">else</span><span class="s"> </span><span class="o">$</span><span class="mi">0</span>
<a id="tutorial_en/tutorial_en.catala_en-1174" name="tutorial_en/tutorial_en.catala_en-1174"></a>
<a id="tutorial_en/tutorial_en.catala_en-1175" name="tutorial_en/tutorial_en.catala_en-1175"></a><span class="kr">declaration</span><span class="s"> </span><span class="kr">scope</span><span class="s"> </span><span class="nc">IncludeInGrossIncome</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-1176" name="tutorial_en/tutorial_en.catala_en-1176"></a><span class="s">  </span><span class="kd">input</span><span class="s"> </span><span class="nv">fair_market_value</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">money</span>
<a id="tutorial_en/tutorial_en.catala_en-1177" name="tutorial_en/tutorial_en.catala_en-1177"></a><span class="s">  </span><span class="kd">input</span><span class="s"> </span><span class="nv">amount_paid</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">money</span>
<a id="tutorial_en/tutorial_en.catala_en-1178" name="tutorial_en/tutorial_en.catala_en-1178"></a><span class="s">  </span><span class="kd">output</span><span class="s"> </span><span class="nv">amount_to_include</span><span class="s"> </span><span class="kr">content</span><span class="s"> </span><span class="kt">money</span>
<a id="tutorial_en/tutorial_en.catala_en-1179" name="tutorial_en/tutorial_en.catala_en-1179"></a>
<a id="tutorial_en/tutorial_en.catala_en-1180" name="tutorial_en/tutorial_en.catala_en-1180"></a><span class="kr">scope</span><span class="s"> </span><span class="nc">IncludeInGrossIncome</span><span class="o">:</span>
<a id="tutorial_en/tutorial_en.catala_en-1181" name="tutorial_en/tutorial_en.catala_en-1181"></a><span class="s">  </span><span class="kr">definition</span><span class="s"> </span><span class="nv">amount_to_include</span><span class="s"> </span><span class="kr">equals</span><span class="s"> </span><span class="nv">excess</span><span class="s"> </span><span class="kd">of</span><span class="s"> </span><span class="nv">fair_market_value</span><span class="o">,</span><span class="s"> </span><span class="nv">amount_paid</span>
</pre></div></td></tr></table></div>

</div>
<div class='law-text'><p>Here the function definition is easier to verify, and the final
definition of the scope is more straightforward, while staying closer to
the original text.</p></div>

</details>


<h1 class='law-heading' id="Annex%20B:%20modules"><a href="#Annex%20B:%20modules">Annex B: modules</a></h1>

<div class='law-text'><p>Modules are “compilation units” in Catala: they can be compiled
separately and reused within different programs. A self-contained corpus
of texts that can be referred to from other corpuses is a good candidate
for a module. It’s possible for a module to rely on other modules, as
long as there is no cyclic dependency.</p></div>
<h2 class='law-heading' id="Annex%20B:%20modules-Declaring%20a%20module"><a href="#Annex%20B:%20modules-Declaring%20a%20module">Declaring a module</a></h2>
<details><summary>Declaring a module</summary>
<div class='law-text'><p>A module is declared with the following syntax:</p></div>

<div class='law-text'><p>This is typically written on top of the file, and the name of the
module must match the name of the file (but for the first letter, which
must be a capital).</p>
<p>Anything that is declared in <code>catala-metadata</code> sections
will be made available to users of the module; things that only appear
in <code>catala</code> sections won’t be visible. For example, a scope
that is <em>defined</em> in a <code>catala</code> section can be
executed from outside of the module as long as it has been
<em>declared</em> in a <code>catala-metadata</code> section.</p>
<p>If a module needs to be split in several files, there must be a main
file declaring the module, in which the basic, textual inclusion is used
with the <code>&gt; Include: file.catala_en</code> directive.</p></div>
</details>
<h2 class='law-heading' id="Annex%20B:%20modules-Using%20modules"><a href="#Annex%20B:%20modules-Using%20modules">Using modules</a></h2>
<details><summary>Using modules</summary>
<div class='law-text'><p>The usage of an external module must be declared, preferably at the
beginning of the file as well. This is done with the directive
<code>&gt; Using SomeModule</code>, with <code>SomeModule</code> the
name of the needed module. To access the declarations from
<code>SomeModule</code> (enumerations, structures, scopes and top-level
values) without mixing them up with the ones from the current, or other
imported modules, they must be prefixed with <code>SomeModule.</code>,
<em>e.g.</em> <code>SomeModule.scope_from_that_module</code>.</p>
<p>For convenience, it is possible to <em>alias</em>, or locally rename
the module using <code>&gt; Using SomeModule as NewName</code>, and
henceforth refer to it with <code>NewName.scope_from_that_module</code>
instead.</p>
<p>To compile multi-module Catala programs, use the dedicated
<code>clerk</code> build-system. It automatically detects and finds the
modules being used and ensures a consistent build of the whole program.
See <code>clerk --help</code> for more detail (if the modules are
scattered across directories, use the <code>-I &lt;directory&gt;</code>
option to lookup modules inside them).</p></div>
</details>

</body>
</html>
